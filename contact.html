<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shashwat | Initialize Comm</title>
    <meta name="theme-color" content="#050505">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Space+Grotesk:wght@300;500;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Space Grotesk', 'sans-serif'], mono: ['Fira Code', 'monospace'] },
                    colors: {
                        // Mapped to CSS Variables for Terminal Switching
                        bgDark: 'var(--bg-primary)',
                        textMain: 'var(--text-primary)',
                        neonCyan: 'var(--accent-primary)',
                        neonBlue: 'var(--accent-secondary)',
                    },
                    animation: { 'infinite-scroll': 'infinite-scroll 25s linear infinite' },
                    keyframes: {
                        'infinite-scroll': {
                            from: { transform: 'translateX(0)' },
                            to: { transform: 'translateX(-100%)' },
                        }
                    }
                }
            }
        }
    </script>

    <script>

        // Check for saved custom theme or default to system
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

    </script>

    <style>
        /* --- DYNAMIC THEME VARIABLES --- */
        :root {
            /* Default Theme (Original Dark) */
            --bg-primary: #050505;
            --text-primary: #e5e5e5;
            --accent-primary: #66fcf1;
            /* Cyan */
            --accent-secondary: #3b82f6;
            /* Blue */
            --grid-color: rgba(102, 252, 241, 0.15);

            /* IDE SPECIFIC VARS (Now Dynamic) */

            /* Mixes main bg with 5% white so the IDE stands out slightly from the page */
            --ide-bg: color-mix(in srgb, var(--bg-primary), white 5%);

            /* Sidebar blends seamlessly with the page background */
            --ide-sidebar: var(--bg-primary);

            /* Borders glow with your theme's main accent color */
            --ide-border: var(--accent-primary);

            /* Status bar uses your secondary accent color */
            --status-bg: var(--accent-secondary);
            --status-fg: #fff;

            /* File list interaction colors derived from theme */
            --file-hover: var(--grid-color);
            --file-active: color-mix(in srgb, var(--accent-primary), transparent 80%);
        }

        /* Smooth Transition for Theme Switching */
        body,
        div,
        section,
        nav,
        footer,
        span,
        h1,
        h2,
        h3,
        p,
        i,
        button,
        input,
        textarea,
        label {
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }

        /* BASE STYLES & SPOTLIGHT FIX */
        html {
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        body {
            overflow-x: hidden;
        }

        /* CYBER GRID */
        .cyber-grid {
            position: fixed;
            inset: 0;
            z-index: 0;
            background-image: none;
            background-size: 40px 40px;
            mask-image: none;
            -webkit-mask-image: none;
            pointer-events: none;
            transition: background-image 0.5s ease, mask-image 0.5s ease, -webkit-mask-image 0.5s ease;
        }

        body.is-hovering .cyber-grid {
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            mask-image: radial-gradient(circle at var(--x, 50%) var(--y, 50%), black 0%, transparent 20%);
            -webkit-mask-image: radial-gradient(circle at var(--x, 50%) var(--y, 50%), black 0%, transparent 20%);
        }

        /* GLASS NAV */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark .glass {
            background: rgba(5, 5, 5, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* CONTACT FORM STYLES */
        .term-input {
            background: transparent;
            border: none;
            border-bottom: 1px solid #ccc;
            width: 100%;
            padding: 10px 0;
            outline: none;
            transition: 0.3s;
            font-family: 'Fira Code';
            color: #333;
        }

        .term-input:focus {
            border-color: var(--accent-secondary);
        }

        .dark .term-input {
            color: var(--text-primary);
            border-bottom-color: #333;
        }

        .dark .term-input:focus {
            border-color: var(--accent-primary);
        }

        /* OVERLAY TERMINAL STYLES */
        #terminal-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            cursor: pointer;
            padding: 0;
            background: none;
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #terminal-toggle:hover {
            transform: scale(1.05);
        }

        #overlay-terminal {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 500px;
            height: 350px;
            min-width: 300px;
            min-height: 200px;
            max-width: 90vw;
            max-height: 90vh;
            z-index: 99;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 15px var(--grid-color);
            display: flex;
            flex-direction: column;
            font-family: 'Fira Code', monospace;
            overflow: hidden;
            resize: both;
        }

        .term-bar {
            padding: 8px 12px;
            background: rgba(102, 252, 241, 0.1);
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
        }

        .term-output-area {
            flex-grow: 1;
            padding: 10px 12px;
            overflow-y: auto;
            color: #e5e5e5;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .term-output-area::-webkit-scrollbar {
            display: block;
            width: 6px;
        }

        .term-output-area::-webkit-scrollbar-thumb {
            background: rgba(102, 252, 241, 0.3);
            border-radius: 3px;
        }

        .term-output-area {
            scrollbar-width: thin;
            scrollbar-color: rgba(102, 252, 241, 0.3) transparent;
        }

        .term-input-line {
            display: flex;
            padding: 5px 12px 8px;
            border-top: 1px solid #333;
            align-items: center;
        }

        .term-prompt {
            color: #00ff00;
            white-space: nowrap;
            margin-right: 5px;
        }

        .term-input-cmd {
            background: transparent;
            border: none;
            color: var(--accent-primary);
            outline: none;
            width: 100%;
            font-size: 0.8rem;
        }

        /* --- UPDATED TERMINAL TABS & PANES --- */
        .term-tab {
            cursor: pointer;
            color: #666;
            padding-bottom: 2px;
            border-bottom: 1px solid transparent;
            transition: all 0.2s;
        }

        .term-tab:hover {
            color: #ccc;
        }

        .term-tab.active {
            color: #fff;
            border-bottom: 1px solid #fff;
            /* The "Active" Underline */
        }

        /* Utility to hide inactive panes */
        .console-pane.hidden {
            display: none;
        }

        .console-pane {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* DEBUG CONSOLE SPECIFIC */
        .debug-input-line {
            display: flex;
            align-items: center;
            border-top: 1px solid #333;
            padding-top: 5px;
            margin-top: 5px;
        }

        .debug-input {
            background: transparent;
            border: none;
            outline: none;
            color: #ce9178;
            /* Orange-ish input color */
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            width: 100%;
            margin-left: 5px;
        }

        /* --- SYSTEM CURSOR --- */

        a,
        button,
        .terminal-card,
        input,
        textarea,
        .project-terminal,
        .skill-card,
        .cert-card {
            cursor: pointer;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .hide-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* --- MOBILE OPTIMIZATION (MAIN INTERFACE) --- */
        @media (max-width: 640px) {

            /* 1. Make the terminal fit the screen */
            #overlay-terminal {
                width: 90% !important;
                left: 5% !important;
                right: 5% !important;
                bottom: 90px !important;
                /* Above the toggle button */
                height: 50vh !important;
                min-width: unset;
            }

            /* 2. Shrink the Toggle Button slightly */
            #terminal-toggle {
                bottom: 20px;
                right: 20px;
                transform: scale(0.9);
            }

            /* 3. Adjust Typography */
            h1 {
                font-size: 2.5rem !important;
                /* Smaller main titles */
                line-height: 1.1;
            }

            /* 4. Fix Timeline Spacing (About/Home) */
            .timeline-line {
                left: 15px;
                /* Adjust line position */
            }

            .timeline-dot {
                left: 10px;
                /* Adjust dot position */
            }

            .relative.pl-8 {
                padding-left: 2rem;
                /* Less padding */
            }

            /* 5. Ensure Grid Background doesn't lag */
            .cyber-grid {
                background-size: 20px 20px;
                /* Smaller grid cells */
            }
        }

        @media (max-width: 640px) {

            /* Prevent iOS Zoom on focus */
            input,
            textarea,
            .term-input,
            .term-input-cmd {
                font-size: 16px !important;
            }
        }

        /* UI Polish */
        #terminal-toggle,
        .term-bar,
        .term-prompt,
        nav a {
            -webkit-user-select: none;
            /* Safari */
            user-select: none;
            /* Standard */
            -webkit-tap-highlight-color: transparent;
            /* Removes blue tap box on Android */
        }

        /* =========================================
   === NEW IDE COMPONENT STYLES ===
========================================= */
        .ide-window {
            width: 1000px;
            max-width: 100%;
            height: 650px;
            background: var(--ide-bg);
            border: 1px solid var(--ide-border);
            border-radius: 8px;
            display: grid;
            grid-template-columns: 48px 220px 1fr;
            grid-template-rows: 1fr 22px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            transition: border-color 0.3s;
            font-family: 'Fira Code', monospace;
        }

        .ide-window:hover {
            border-color: var(--accent-primary);
        }

        /* 1. ACTIVITY BAR */
        .activity-bar {
            background: #333;
            grid-row: 1 / 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
            border-right: 1px solid #111;
        }

        .act-icon {
            width: 48px;
            height: 48px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: #858585;
            cursor: pointer;
            position: relative;
        }

        .act-icon:hover,
        .act-icon.active {
            color: #fff;
        }

        .act-icon.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 2px;
            background: var(--accent-primary);
        }

        /* 2. SIDEBAR */
        .folder-header i {
            transition: transform 0.2s ease;
            margin-right: 4px;
        }

        .ide-sidebar {
            background: var(--ide-sidebar);
            grid-row: 1 / 2;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #111;
            font-size: 13px;
        }

        .explorer-header {
            padding: 10px 20px;
            font-size: 11px;
            font-weight: bold;
            color: #bbbbbb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-header {
            padding: 4px 10px;
            font-weight: bold;
            color: #cccccc;
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px 20px;
            cursor: pointer;
            color: #cccccc;
            text-decoration: none;
            border: 1px solid transparent;
        }

        .file-item:hover {
            background: var(--file-hover);
            color: #fff;
        }

        .file-item.active {
            background: var(--file-active);
            color: #fff;
        }

        .icon-html {
            color: #e44d26;
            font-size: 16px;
            font-weight: normal;
        }

        /* 3. EDITOR - FIXED LAYOUT */
        .editor-main {
            grid-row: 1 / 2;
            display: flex;
            flex-direction: column;
            background: var(--ide-bg);
            position: relative;
            overflow: hidden;
            /* Critical: Prevents entire editor from expanding */
        }

        .tab-bar {
            height: 35px;
            background: #252526;
            display: flex;
            align-items: center;
            overflow-x: auto;
            flex-shrink: 0;
            /* Never shrink the tabs */
        }

        .tab {
            height: 100%;
            padding: 0 10px;
            background: #1e1e1e;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            border-top: 1px solid var(--accent-primary);
            border-right: 1px solid #252526;
            min-width: 120px;
        }

        .lang-switch {
            margin-left: auto;
            padding-right: 10px;
            display: flex;
            gap: 5px;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid transparent;
            color: #666;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            cursor: pointer;
        }

        .lang-btn.active {
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
        }

        /* --- STATIC WORKSPACE (Main Code Area) --- */
        .editor-workspace {
            position: relative;
            flex-grow: 1;
            /* Take all remaining space */
            flex-shrink: 1;
            /* Allow shrinking if needed */
            min-height: 0;
            /* CRITICAL FIX: Allows scrolling inside flex item */
            display: flex;
            overflow: hidden;
            background: var(--ide-bg);
        }

        .code-container {
            flex-grow: 1;
            display: flex;
            overflow: hidden;
            padding-right: 60px;
            /* Space for absolute minimap */
        }

        .line-nums {
            width: 45px;
            text-align: right;
            padding: 10px 15px 0 0;
            color: #858585;
            font-size: 14px;
            line-height: 24px;
            user-select: none;
            flex-shrink: 0;
        }

        .code-body {
            flex-grow: 1;
            padding: 10px 0 0 10px;
            font-size: 14px;
            line-height: 24px;
            overflow-y: auto;
            color: #d4d4d4;
        }

        /* --- STATIC MINIMAP (Pinned Right) --- */
        .minimap {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 60px;
            background: var(--ide-bg);
            border-left: 1px solid #2a2a2a;
            z-index: 10;
            overflow: hidden;
        }

        canvas#minimap-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .minimap-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: none;
        }

        /* --- TERMINAL RESIZER --- */
        .resizer-bar {
            height: 4px;
            background: #2a2a2a;
            cursor: row-resize;
            transition: background 0.2s;
            width: 100%;
            z-index: 20;
            flex-shrink: 0;
            /* Never collapse */
        }

        .resizer-bar:hover,
        .resizer-bar.resizing {
            background: var(--accent-primary);
        }

        /* --- TERMINAL PANE --- */
        .ide-terminal-pane {
            height: 140px;
            /* Default Height */
            min-height: 50px;
            border-top: 1px solid var(--ide-border);
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            /* CRITICAL: Prevents terminal from disappearing */
            z-index: 15;
            position: relative;
        }

        .ide-term-bar {
            padding: 4px 15px;
            font-size: 11px;
            color: #aaa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .ide-term-content {
            flex-grow: 1;
            padding: 8px 15px;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            overflow-y: auto;
            color: #cccccc;
        }

        .run-btn {
            background: var(--accent-primary);
            color: #000;
            padding: 2px 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 10px;
            border-radius: 2px;
        }

        /* Git Blame Style */
        .git-blame {
            display: inline-block;
            margin-left: 15px;
            color: #555;
            font-style: italic;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .input-group:focus-within .git-blame {
            opacity: 1;
        }

        /* --- NEW: CONTACT INPUTS FIX --- */
        .ide-input {
            background-color: transparent !important;
            background: transparent !important;
            border: none;
            outline: none;
            color: #ce9178;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            border-bottom: 1px dashed #444;
            width: 180px;
            padding: 0;
            margin: 0;
            transition: border-color 0.2s;
        }

        /* REMOVES WHITE AUTOFILL BACKGROUND */
        .ide-input:-webkit-autofill,
        .ide-input:-webkit-autofill:hover,
        .ide-input:-webkit-autofill:focus,
        .ide-input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px var(--ide-bg) inset !important;
            -webkit-text-fill-color: #ce9178 !important;
            transition: background-color 5000s ease-in-out 0s;
        }

        .ide-input:focus {
            border-bottom: 1px solid var(--accent-primary);
        }

        .ide-input.error {
            border-bottom-color: #ff5555;
        }

        /* 4. STATUS BAR */
        .status-bar {
            grid-column: 1 / 4;
            grid-row: 2 / 3;
            background: var(--status-bg);
            color: var(--status-fg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            font-size: 12px;
            z-index: 10;
            cursor: default;
        }

        .sb-left,
        .sb-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-building {
            background: #d97706 !important;
        }

        .status-ready {
            background: #16a34a !important;
        }

        /* SYNTAX COLORS */
        .kwd {
            color: #569cd6;
        }

        .str {
            color: #ce9178;
        }

        .fun {
            color: #dcdcaa;
        }

        .var {
            color: #9cdcfe;
        }

        .theme-rust .kwd {
            color: #ff5c57;
        }

        /* Responsive Fix */
        @media (max-width: 768px) {
            .ide-window {
                grid-template-columns: 50px 1fr;
                height: 80vh;
            }

            .ide-sidebar {
                display: none;
            }
        }

        /* --- NEW: TERMINAL RESIZER --- */
        .resizer-bar {
            height: 4px;
            background: #2a2a2a;
            /* Subtle separator color */
            cursor: row-resize;
            transition: background 0.2s;
            z-index: 20;
            width: 100%;
        }

        .resizer-bar:hover,
        .resizer-bar.resizing {
            background: var(--accent-primary);
            /* Highlights when grabbed */
        }

        /* --- UPDATED: MINIMAP CONTAINER --- */
        .minimap {
            width: 60px;
            /* Slightly wider */
            background: var(--ide-bg);
            border-left: 1px solid #2a2a2a;
            opacity: 1;
            /* Remove global opacity for clearer colors */
            position: relative;
            /* For the shadow overlay */
            overflow: hidden;
        }

        /* The "Viewport Shadow" simulates the current scroll position */
        .minimap-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: none;
        }

        /* TERMINAL PANE - ADD THIS BACK */
        .ide-terminal-pane {
            height: 140px;
            /* Default starting height */
            min-height: 50px;
            /* Safety minimum */
            border-top: 1px solid var(--ide-border);
            background: #1e1e1e;
            display: flex;
            flex-direction: column;

            /* CRITICAL FIX: Prevents the panel from being crushed by the editor above */
            flex-shrink: 0;
        }

        .cmd-item {
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            color: #ccc;
            font-size: 13px;
            font-family: 'Fira Code', monospace;
        }

        .cmd-item:hover,
        .cmd-item.selected {
            background-color: var(--accent-primary);
            /* Uses your theme color! */
            color: #000;
        }

        .cmd-key {
            font-size: 11px;
            opacity: 0.7;
        }
    </style>
</head>

<body
    class="bg-gray-50 text-gray-900 dark:bg-bgDark dark:text-textMain transition-colors duration-300 min-h-screen flex flex-col">

    <div class="cyber-grid"></div>

    <nav class="fixed w-full z-50 top-0 start-0 glass transition-all duration-300">
        <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between p-4">
            <a href="home.html" class="flex items-center gap-2 group">
                <div
                    class="w-8 h-8 bg-neonBlue dark:bg-neonCyan rounded flex items-center justify-center text-white dark:text-black font-bold font-mono group-hover:rotate-12 transition-transform">
                    &lt;/&gt;</div>
                <span class="self-center text-xl font-bold tracking-wide dark:text-textMain">CodeBaaz</span>
            </a>
            <div
                class="flex items-center gap-6 font-mono text-sm overflow-x-auto w-full md:w-auto pb-2 md:pb-0 hide-scrollbar">
                <a href="home.html" class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/Home</a>
                <a href="about.html" class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/About</a>
                <a href="projects.html"
                    class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/Work</a>
                <a href="contact.html" class="text-neonBlue dark:text-neonCyan">~/Contact</a>

                <button id="theme-toggle"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-white/10 transition-all">
                    <i class="ri-sun-line dark:hidden text-orange-500"></i>
                    <i class="ri-moon-line hidden dark:block text-neonCyan"></i>
                </button>
            </div>
        </div>
    </nav>

    <section id="contact-page"
        class="relative z-10 pt-32 pb-20 container mx-auto px-4 flex-grow flex items-center justify-center">

        <div class="ide-window shadow-2xl">

            <div class="activity-bar">
                <div class="act-icon active"><i class="ri-file-code-line"></i></div>
                <div class="act-icon"><i class="ri-search-line"></i></div>
                <div class="act-icon"><i class="ri-git-merge-line"></i></div>
                <div class="act-icon" style="margin-top:auto; margin-bottom: 10px;"><i class="ri-settings-3-line"></i>
                </div>
            </div>

            <div class="ide-sidebar">
                <div class="explorer-header">
                    <span>EXPLORER</span>
                    <i class="ri-more-fill cursor-pointer hover:text-white"></i>
                </div>

                <div class="folder-header" onclick="toggleFolder('f-port', this)">
                    <i class="ri-arrow-down-s-line"></i>
                    <span>PORTFOLIO</span>
                </div>
                <div id="f-port" class="folder-content">
                    <a href="about.html" class="file-item">
                        <i class="ri-code-s-slash-line icon-html"></i>
                        <span>about.html</span>
                    </a>
                    <a href="contact.html" class="file-item active">
                        <i class="ri-code-s-slash-line icon-html"></i>
                        <span>contact.html</span>
                    </a>
                    <a href="home.html" class="file-item">
                        <i class="ri-code-s-slash-line icon-html"></i>
                        <span>home.html</span>
                    </a>
                    <a href="projects.html" class="file-item">
                        <i class="ri-code-s-slash-line icon-html"></i>
                        <span>projects.html</span>
                    </a>
                </div>

                <div class="folder-header" onclick="toggleFolder('f-data', this)">
                    <i class="ri-arrow-right-s-line"></i>
                    <span>DATA</span>
                </div>
                <div id="f-data" class="folder-content hidden">
                    <div class="file-item" onclick="openDummy('skills.json')">
                        <i class="ri-braces-line text-yellow-400 text-base"></i>
                        <span>skills.json</span>
                    </div>
                    <div class="file-item" onclick="openDummy('resume.yaml')">
                        <i class="ri-file-list-2-line text-purple-400 text-base"></i>
                        <span>resume.yaml</span>
                    </div>
                </div>

                <div class="folder-header" onclick="toggleFolder('f-conf', this)">
                    <i class="ri-arrow-right-s-line"></i>
                    <span>CONFIG</span>
                </div>
                <div id="f-conf" class="folder-content hidden">
                    <div class="file-item" onclick="openDummy('package.json')">
                        <i class="ri-braces-line text-yellow-400 text-base"></i>
                        <span>package.json</span>
                    </div>
                    <div class="file-item" onclick="openDummy('.env.local')">
                        <i class="ri-settings-4-line text-gray-500 text-base"></i>
                        <span>.env.local</span>
                    </div>
                </div>
            </div>

            <div class="editor-main">
                <div class="tab-bar">
                    <div class="tab">
                        <span id="tab-icon" class="text-yellow-400 ri-javascript-fill"></span>
                        <span id="tab-name">contact.js</span>
                        <i class="ri-close-line" style="margin-left: auto; opacity: 0.7;"></i>
                    </div>
                    <div class="lang-switch">
                        <button class="lang-btn active" onclick="setLang('js')" data-lang="js">JS</button>
                        <button class="lang-btn" onclick="setLang('python')" data-lang="python">PY</button>
                        <button class="lang-btn" onclick="setLang('rust')" data-lang="rust">RS</button>
                        <button class="lang-btn" onclick="setLang('go')" data-lang="go">GO</button>
                    </div>
                </div>

                <div class="editor-workspace">
                    <div class="code-container">
                        <div class="line-nums">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
                        <div class="code-body" id="code-body"></div>
                    </div>
                    <div class="minimap">
                        <canvas id="minimap-canvas"></canvas>
                        <div class="minimap-overlay"></div>
                    </div>
                </div>

                <div id="term-resizer" class="resizer-bar"></div>

                <div class="ide-terminal-pane" id="ide-terminal">
                    <div class="ide-term-bar">
                        <div class="flex gap-4 select-none">
                            <span class="term-tab" id="tab-prob" onclick="switchConsoleTab('prob')">PROBLEMS</span>
                            <span class="term-tab active" id="tab-term"
                                onclick="switchConsoleTab('term')">TERMINAL</span>
                            <span class="term-tab" id="tab-out" onclick="switchConsoleTab('out')">OUTPUT</span>
                            <span class="term-tab" id="tab-debug" onclick="switchConsoleTab('debug')">DEBUG
                                CONSOLE</span>
                        </div>
                        <button class="run-btn" onclick="deploy()">▶ RUN (Ctrl+Enter)</button>
                    </div>

                    <div id="pane-prob" class="ide-term-content console-pane hidden">
                        <div class="text-gray-400 italic">No problems have been detected in the workspace.</div>
                    </div>

                    <div id="pane-term" class="ide-term-content console-pane">
                        <div class="text-gray-500">Microsoft Windows [Version 10.0.19045.3693]</div>
                        <div class="text-gray-500">(c) Microsoft Corporation. All rights reserved.</div>
                        <br>
                        <div class="text-green-500">➜ ~/workspace <span class="text-gray-300 animate-pulse">_</span>
                        </div>
                    </div>

                    <div id="pane-out" class="ide-term-content console-pane hidden">
                        <div class="text-gray-500">[System] Extension 'ContactForm' v1.0.0 activated.</div>
                        <div class="text-gray-500">[System] Resolving dependencies... Done.</div>
                        <div class="text-blue-400">[Info] Waiting for user input...</div>
                    </div>

                    <div id="pane-debug" class="ide-term-content console-pane hidden">
                        <div class="text-gray-400">Debug Console attached. Type 'help' for commands.</div>
                        <div id="debug-log" class="flex-grow overflow-y-auto"></div>
                        <div class="debug-input-line">
                            <span class="text-blue-500">>></span>
                            <input type="text" class="debug-input" id="debug-cmd" placeholder="Evaluate expression..."
                                autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-bar" id="status-bar">
                <div class="sb-left">
                    <div class="sb-item"><i class="ri-git-branch-line"></i> main*</div>
                    <div class="sb-item"><i class="ri-refresh-line"></i> 0</div>
                    <div class="sb-item"><i class="ri-error-warning-line"></i> 0</div>
                </div>
                <div class="sb-right">
                    <div class="sb-item" id="lang-stat">JavaScript</div>
                    <div class="sb-item"><i class="ri-notification-3-line"></i></div>
                </div>
            </div>
        </div>

    </section>

    <footer id="main-footer" class="bg-black border-t border-gray-800 relative z-10">
        <div class="w-full py-8 overflow-hidden relative border-b border-gray-800">
            <div class="absolute inset-0 bg-gradient-to-r from-black via-transparent to-black z-10 pointer-events-none">
            </div>
            <div class="flex w-full overflow-hidden">
                <div class="flex animate-infinite-scroll gap-16 items-center px-4">
                    <i
                        class="ri-reactjs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-400 transition-colors"></i>
                    <i
                        class="ri-html5-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-orange-500 transition-colors"></i>
                    <i
                        class="ri-css3-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-600 transition-colors"></i>
                    <i
                        class="ri-javascript-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-yellow-400 transition-colors"></i>
                    <i
                        class="ri-nodejs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-green-500 transition-colors"></i>
                    <i
                        class="ri-reactjs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-400 transition-colors"></i>
                    <i
                        class="ri-html5-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-orange-500 transition-colors"></i>
                    <i
                        class="ri-css3-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-600 transition-colors"></i>
                    <i
                        class="ri-javascript-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-yellow-400 transition-colors"></i>
                    <i
                        class="ri-nodejs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-green-500 transition-colors"></i>
                </div>
            </div>
        </div>

        <div
            class="max-w-7xl mx-auto px-6 py-6 flex justify-between items-center text-xs font-mono text-gray-400 dark:text-gray-500">
            <div class="flex items-center gap-2"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                System Operational</div>
            <div id="clock">00:00:00 UTC</div>
        </div>
    </footer>
    <button id="terminal-toggle" aria-label="Open Terminal">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100">
            <rect width="100" height="100" rx="10" ry="10" fill="#000000" stroke="var(--accent-primary)"
                stroke-width="3" />
            <text x="50" y="50" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif"
                font-size="35" fill="var(--accent-primary)" font-weight="bold">
                &lt;/&gt;
            </text>
            <circle cx="80" cy="80" r="10" fill="#27c93f" stroke="#000000" stroke-width="2" />
        </svg>
    </button>

    <div id="overlay-terminal" style="display: none;">
        <div class="term-bar" id="term-header">
            <span class="text-neonCyan font-bold text-sm">System Terminal — contact.html</span>
            <span class="text-sm cursor-pointer"
                onclick="document.getElementById('overlay-terminal').style.display='none';"><i
                    class="ri-close-line text-white/50 hover:text-white"></i></span>
        </div>
        <div class="term-output-area" id="terminal-output">
            <div class="text-xs text-gray-400 pb-2 border-b border-gray-800 mb-2">
                Welcome to Shashwat's System Shell (SSH). Type 'help' for commands.
            </div>
        </div>
        <div class="term-input-line">
            <span class="term-prompt" id="current-prompt">Shash@port:~$</span>
            <input type="text" id="terminal-input" class="term-input-cmd" autocomplete="off" autofocus>
        </div>
    </div>
    <script>
        // --- IDE CONTACT FORM LOGIC ---

        const ideTemplates = {
            js: {
                file: 'contact.js', name: 'JavaScript',
                code: () => `
            <div><span class="kwd">import</span> { <span class="var">send</span> } <span class="kwd">from</span> <span class="str">'./api'</span>;</div>
            <br>
            <div><span class="kwd">const</span> <span class="var">payload</span> = {</div>
            <div class="input-group">&nbsp;&nbsp;name: <span class="str">"<input id="i-name" placeholder="Name" class="ide-input">"</span>,<span class="git-blame">// You, seconds ago</span></div>
            <div class="input-group">&nbsp;&nbsp;email: <span class="str">"<input id="i-email" placeholder="Email" class="ide-input">"</span>,<span class="git-blame">// Uncommitted change</span></div>
            <div class="input-group">&nbsp;&nbsp;body: <span class="str">"<input id="i-msg" placeholder="Message" class="ide-input">"</span></div>
            <div>};</div>
            <br>
            <div><span class="kwd">await</span> <span class="fun">send</span>(<span class="var">payload</span>);</div>`
            },
            python: {
                file: 'contact.py', name: 'Python',
                code: () => `
            <div><span class="kwd">import</span> requests</div>
            <br>
            <div><span class="kwd">def</span> <span class="fun">contact_host</span>():</div>
            <div class="input-group">&nbsp;&nbsp;data = {</div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"u_name"</span>: <span class="str">"<input id="i-name" placeholder="Name" class="ide-input">"</span>,<span class="git-blame"># Blame: You</span></div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"u_mail"</span>: <span class="str">"<input id="i-email" placeholder="Email" class="ide-input">"</span>,<span class="git-blame"># Edited just now</span></div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;<span class="str">"u_text"</span>: <span class="str">"<input id="i-msg" placeholder="Message" class="ide-input">"</span></div>
            <div class="input-group">&nbsp;&nbsp;}</div>
            <br>
            <div>&nbsp;&nbsp;requests.<span class="fun">post</span>(API, json=data)</div>`
            },
            rust: {
                file: 'contact.rs', name: 'Rust',
                code: () => `
            <div><span class="kwd">fn</span> <span class="fun">main</span>() {</div>
            <div>&nbsp;&nbsp;<span class="kwd">let</span> <span class="kwd">mut</span> msg = <span class="var">Msg</span>::new();</div>
            <br>
            <div class="input-group">&nbsp;&nbsp;msg.name = <span class="str">"<input id="i-name" placeholder="Name" class="ide-input">"</span>.to_string();<span class="git-blame">// ref: HEAD</span></div>
            <div class="input-group">&nbsp;&nbsp;msg.mail = <span class="str">"<input id="i-email" placeholder="Email" class="ide-input">"</span>.to_string();</div>
            <div class="input-group">&nbsp;&nbsp;msg.body = <span class="str">"<input id="i-msg" placeholder="Message" class="ide-input">"</span>.to_string();</div>
            <br>
            <div>&nbsp;&nbsp;<span class="var">Server</span>::<span class="fun">push</span>(&msg).unwrap();</div>
            <div>}</div>`
            },
            go: {
                file: 'main.go', name: 'Go',
                code: () => `
            <div><span class="kwd">func</span> <span class="fun">main</span>() {</div>
            <div class="input-group">&nbsp;&nbsp;m := <span class="var">Message</span>{</div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;User: <span class="str">"<input id="i-name" placeholder="Name" class="ide-input">"</span>,<span class="git-blame">// func: init</span></div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;Mail: <span class="str">"<input id="i-email" placeholder="Email" class="ide-input">"</span>,</div>
            <div class="input-group">&nbsp;&nbsp;&nbsp;&nbsp;Text: <span class="str">"<input id="i-msg" placeholder="Message" class="ide-input">"</span>,</div>
            <div>&nbsp;&nbsp;}</div>
            <div>&nbsp;&nbsp;<span class="var">fmt</span>.<span class="fun">Println</span>(m)</div>
            <div>}</div>`
            }
        };

        let currentLang = 'js';
        const formValues = { name: '', email: '', msg: '' };

        function setLang(lang) {
            currentLang = lang;
            const t = ideTemplates[lang];

            // UI Updates
            document.getElementById('tab-name').innerText = t.file;
            document.getElementById('lang-stat').innerText = t.name;

            const tabIcon = document.getElementById('tab-icon');
            tabIcon.className = lang === 'js' ? 'ri-javascript-fill text-yellow-400' :
                lang === 'python' ? 'ri-terminal-box-line text-blue-400' :
                    'ri-code-s-slash-line text-white';

            // --- NEW: TYPEWRITER / FADE EFFECT ---
            const codeBody = document.getElementById('code-body');

            // 1. Hide initially
            codeBody.style.opacity = '0';
            codeBody.style.transition = 'none'; // Disable transition for instant hide

            // 2. Insert Content
            codeBody.innerHTML = t.code();

            // 3. Trigger Fade In (Small delay to allow DOM render)
            setTimeout(() => {
                codeBody.style.transition = 'opacity 0.3s ease-in';
                codeBody.style.opacity = '1';
            }, 50);

            // Restore Inputs
            if (formValues.name) document.getElementById('i-name').value = formValues.name;
            if (formValues.email) document.getElementById('i-email').value = formValues.email;
            if (formValues.msg) document.getElementById('i-msg').value = formValues.msg;

            bindInputs();
            drawMinimap();
            updateActiveBtns();
        }

        function bindInputs() {
            document.querySelectorAll('.ide-input').forEach(inp => {
                // 1. INPUT EVENT: Handles data binding and Sound Effects
                inp.addEventListener('input', (e) => {
                    const id = e.target.id;

                    // Update the formValues object
                    if (id === 'i-name') formValues.name = e.target.value;
                    if (id === 'i-email') formValues.email = e.target.value;
                    if (id === 'i-msg') formValues.msg = e.target.value;
                    e.target.classList.remove('error');

                    // SUGGESTION 2: Trigger mechanical key sound if available
                    if (typeof playKeyClick === 'function') {
                        playKeyClick();
                    }
                });

                // 2. KEYDOWN EVENT: Handles Keyboard Shortcuts
                inp.addEventListener('keydown', (e) => {
                    // Existing Shortcut: Deploy
                    if (e.ctrlKey && e.key === 'Enter') {
                        deploy();
                    }

                    // BONUS SUGGESTION: Simulate "Save" (Ctrl+S)
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault(); // Prevents browser from saving the HTML file
                        const term = document.getElementById('ide-term-out');

                        // Print a VS Code-style "Saved" message to the internal terminal
                        term.innerHTML += `<div class="text-gray-400">>> File saved locally. Ready to deploy.</div>`;
                        term.scrollTop = term.scrollHeight;
                    }
                });
            });
        }

        function updateActiveBtns() {
            // 1. Remove 'active' class from ALL buttons first
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));

            // 2. Select the specific button that matches the current language
            const activeBtn = document.querySelector(`.lang-btn[data-lang="${currentLang}"]`);

            // 3. Add the class only to that button
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        // Replace your existing deploy() function with this:
        async function deploy() {
            const bar = document.getElementById('status-bar');
            const term = document.getElementById('pane-term');
            const probPane = document.getElementById('pane-prob'); // NEW target

            // 1. Get Values
            const name = document.getElementById('i-name').value;
            const email = document.getElementById('i-email').value;
            const message = document.getElementById('i-msg').value;

            // --- 2. VALIDATION & ERROR COUNTING ---
            if (!name || !email || !message) {
                // Calculate error count
                const errCount = [name, email, message].filter(v => !v).length;

                // A. Update Status Bar
                const errLabel = document.querySelector('.ri-error-warning-line').parentNode;
                if (errLabel) {
                    errLabel.innerHTML = `<i class="ri-error-warning-line text-red-500"></i> ${errCount}`;
                    errLabel.classList.add('text-red-500');
                }

                // B. Update Terminal
                term.innerHTML += `<div class="text-red-500 mt-1">>> ERROR: Compilation failed. ${errCount} missing module(s).</div>`;
                term.scrollTop = term.scrollHeight;

                // C. Highlight Inputs
                document.querySelectorAll('.ide-input').forEach(i => { if (!i.value) i.classList.add('error'); });

                // D. Log to Output
                logToOutput(`Build failed: ${errCount} missing input fields.`, 'error');

                // E. NEW: Populate PROBLEMS Tab
                if (probPane) {
                    probPane.innerHTML = ''; // Clear old errors

                    // Helper to generate the error line HTML
                    const addError = (msg, inputId, line) => {
                        probPane.innerHTML += `
                    <div class="cursor-pointer hover:bg-white/5 p-1 text-red-400 font-mono text-xs mb-1 transition-colors" 
                         onclick="focusInput('${inputId}')">
                        <i class="ri-close-circle-line"></i> 
                        <span class="text-gray-500">[Error]</span> ${ideTemplates[currentLang].file}:${line}:1 
                        <span class="text-gray-300">- ${msg}</span>
                    </div>`;
                    };

                    // Add specific errors based on missing fields
                    if (!name) addError(`'name' is defined but never assigned a value.`, 'i-name', 5);
                    if (!email) addError(`'email' cannot be void.`, 'i-email', 6);
                    if (!message) addError(`Argument 'message' missing in payload.`, 'i-msg', 7);

                    // Automatically switch to the problems tab to show user
                    switchConsoleTab('prob');
                }
                return;
            }

            // --- RESET ERROR COUNT (If validation passes) ---
            const errLabel = document.querySelector('.ri-error-warning-line').parentNode;
            if (errLabel) {
                errLabel.innerHTML = `<i class="ri-error-warning-line"></i> 0`;
                errLabel.classList.remove('text-red-500');
            }

            // Clear Problems Pane on start
            if (probPane) probPane.innerHTML = `<div class="text-gray-500 italic p-2">Building...</div>`;

            // 3. UI: Start "Build"
            bar.classList.add('status-building');
            term.innerHTML += `<div class="text-yellow-500 mt-2">>> Building ${ideTemplates[currentLang].file}...</div>`;
            term.scrollTop = term.scrollHeight;

            logToOutput(`Starting build for ${ideTemplates[currentLang].file}...`);
            logToOutput(`Target: Production (Release)`);

            try {
                const response = await fetch("https://api.web3forms.com/submit", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", Accept: "application/json" },
                    body: JSON.stringify({
                        access_key: "e48ea064-c4b0-46d0-86c5-dbda6644e805",
                        name: name,
                        email: email,
                        message: message
                    })
                });

                const result = await response.json();

                if (result.success) {
                    bar.classList.remove('status-building');
                    bar.classList.add('status-ready');

                    term.innerHTML += `<div class="text-green-400">>> Success: Packet delivered [200 OK].</div>`;
                    term.innerHTML += `<div class="text-gray-500">>> Server response: ${result.message}</div>`;

                    logToOutput(`POST /api/submit - 200 OK`, 'success');
                    logToOutput(`Build completed successfully.`, 'success');

                    // Clear inputs
                    document.querySelectorAll('.ide-input').forEach(i => i.value = '');

                    // Clear Problems Pane
                    if (probPane) probPane.innerHTML = `<div class="text-green-500 italic p-2">>> No problems found. Build clean.</div>`;

                } else {
                    throw new Error("API Error");
                }
            } catch (error) {
                bar.classList.remove('status-building');
                term.innerHTML += `<div class="text-red-500">>> ERROR: Connection Refused. Check Network.</div>`;
                logToOutput(`Connection Error: ${error.message}`, 'error');
            }

            term.scrollTop = term.scrollHeight;
            setTimeout(() => bar.classList.remove('status-ready'), 5000);
        }

        function focusInput(id) {
            const el = document.getElementById(id);
            if (el) {
                el.focus();
                // Add a temporary flash effect
                el.style.backgroundColor = 'rgba(239, 68, 68, 0.2)'; // Red flash
                el.style.transition = 'background-color 0.3s';
                setTimeout(() => {
                    el.style.backgroundColor = 'transparent';
                }, 500);
            }
        }

        // Initialize IDE
        document.addEventListener('DOMContentLoaded', () => {
            setLang('js');
        });
        // --- Shared Terminal Logic (STARTS HERE) ---

        const terminalOutput = document.getElementById('terminal-output');
        const terminalInput = document.getElementById('terminal-input');
        const overlayTerminal = document.getElementById('overlay-terminal');
        const toggleButton = document.getElementById('terminal-toggle');
        const promptSpan = document.getElementById('current-prompt');

        const PROMPT = 'Shash@port:~$';

        // --- HISTORY LOGIC ---
        let commandHistory = [];
        let historyIndex = -1;

        // --- THEME DATABASE & LOGIC ---
        const themeData = {
            'default': {
                '--bg-primary': '#050505',
                '--text-primary': '#e5e5e5',
                '--accent-primary': '#66fcf1',
                '--accent-secondary': '#3b82f6',
                '--grid-color': 'rgba(102, 252, 241, 0.15)'
            },
            'matrix': {
                '--bg-primary': '#000000',
                '--text-primary': '#00dd00',
                '--accent-primary': '#00ff41',
                '--accent-secondary': '#008f11',
                '--grid-color': 'rgba(0, 255, 65, 0.2)'
            },
            'cyberpunk': {
                '--bg-primary': '#0f0014',
                '--text-primary': '#fcee0a',
                '--accent-primary': '#ff003c',
                '--accent-secondary': '#00f0ff',
                '--grid-color': 'rgba(255, 0, 60, 0.2)'
            },
            'ocean': {
                '--bg-primary': '#001e2b',
                '--text-primary': '#e0f7fa',
                '--accent-primary': '#00e5ff',
                '--accent-secondary': '#18ffff',
                '--grid-color': 'rgba(0, 229, 255, 0.15)'
            },
            'sunset': {
                '--bg-primary': '#2d1b2e',
                '--text-primary': '#ffcc00',
                '--accent-primary': '#ff5e62',
                '--accent-secondary': '#ff9966',
                '--grid-color': 'rgba(255, 94, 98, 0.2)'
            },
            'dracula': {
                '--bg-primary': '#282a36',
                '--text-primary': '#f8f8f2',
                '--accent-primary': '#ff79c6',
                '--accent-secondary': '#bd93f9',
                '--grid-color': 'rgba(189, 147, 249, 0.15)'
            },
            'coffee': {
                '--bg-primary': '#2b211e',
                '--text-primary': '#dcc9bc',
                '--accent-primary': '#d4a373',
                '--accent-secondary': '#a98467',
                '--grid-color': 'rgba(212, 163, 115, 0.15)'
            },
            'light': {
                '--bg-primary': '#ffffff',
                '--text-primary': '#111827',
                '--accent-primary': '#2563eb',
                '--accent-secondary': '#4f46e5',
                '--grid-color': 'rgba(37, 99, 235, 0.1)'
            }
        };

        function applyTheme(themeName) {
            const theme = themeData[themeName];
            if (!theme) return false;

            const root = document.documentElement;

            // 1. Update CSS Variables
            for (const [property, value] of Object.entries(theme)) {
                root.style.setProperty(property, value);
            }

            // 2. Handle Tailwind Dark Mode Class
            if (themeName === 'light') {
                root.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                root.classList.add('dark');
                localStorage.theme = 'dark';
            }

            // 3. Persist specific theme name
            localStorage.customTheme = themeName;
            return true;
        }

        // Restore theme on load
        if (localStorage.customTheme && themeData[localStorage.customTheme]) {
            applyTheme(localStorage.customTheme);
        }

        // --- Terminal Utility Functions ---

        function echoInput(command) {
            const outputLine = document.createElement('div');
            outputLine.innerHTML = `<span class="term-prompt">${PROMPT}</span> ${command}`;
            terminalOutput.appendChild(outputLine);
        }

        function print(message, colorClass = 'text-white') {
            const outputLine = document.createElement('div');
            outputLine.innerHTML = `<span class="${colorClass}">${message}</span>`;
            terminalOutput.appendChild(outputLine);
        }

        function scrollToBottom() {
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        // --- Terminal Command Definitions ---

        const commands = {
            'whoami': {
                desc: 'Displays author bio and primary role.',
                exec: () => {
                    speak("Authenticating user... Identity verified: Shashwat Singh."); // <--- ADD THIS
                    print("Name: Shashwat Singh", 'text-neonCyan');
                    print("Role: Full Stack Developer / System Architect", 'text-neonCyan');
                    print("Motto: Building scalable systems, line by line.", 'text-gray-400');
                }
            },
            'cam': {
                desc: 'Activates the ASCII Reflection Protocol (Webcam).',
                exec: () => {
                    print("[INIT] Accessing optical sensors...", "text-yellow-500");

                    const video = document.createElement('video');
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d', { willReadFrequently: true });

                    // ASCII Setup
                    const chars = "Ñ@#W$9876543210?!abc;:+=-,._                    ";
                    const termOutput = document.getElementById('terminal-output');
                    const asciiDiv = document.createElement('div');
                    asciiDiv.style.fontFamily = 'monospace';
                    asciiDiv.style.fontSize = '6px'; // Tiny font for high res
                    asciiDiv.style.lineHeight = '6px';
                    asciiDiv.style.whiteSpace = 'pre';
                    asciiDiv.style.overflow = 'hidden';
                    asciiDiv.className = 'text-neonBlue animate-pulse';
                    termOutput.appendChild(asciiDiv);

                    navigator.mediaDevices.getUserMedia({ video: { width: 100, height: 100 } })
                        .then(stream => {
                            video.srcObject = stream;
                            video.play();

                            const frame = () => {
                                if (!video.srcObject) return; // Stop if stream cut

                                canvas.width = 100;
                                canvas.height = 60; // Aspect ratio adjustment
                                ctx.drawImage(video, 0, 0, 100, 60);

                                const imageData = ctx.getImageData(0, 0, 100, 60);
                                const data = imageData.data;
                                let asciiStr = "";

                                for (let i = 0; i < data.length; i += 4) {
                                    const r = data[i];
                                    const g = data[i + 1];
                                    const b = data[i + 2];
                                    const avg = (r + g + b) / 3;
                                    const charIndex = Math.floor((avg / 255) * (chars.length - 1));

                                    asciiStr += chars[charIndex];
                                    if ((i / 4 + 1) % 100 === 0) asciiStr += "\n";
                                }

                                asciiDiv.innerText = asciiStr;
                                requestAnimationFrame(frame);
                            };
                            frame();
                            print("[SUCCESS] Optical feed established.", "text-green-500");
                        })
                        .catch(e => print("[ERROR] Sensor access denied.", "text-red-500"));
                }
            },
            'theme': {
                desc: 'Change system UI colors. Usage: theme [name] | theme list',
                exec: (args) => {
                    const subCmd = args[1];

                    if (subCmd === 'list') {
                        print("Available Themes:", 'text-neonCyan');
                        Object.keys(themeData).forEach(t => {
                            print(`  - ${t}`, 'text-gray-400');
                        });
                        return;
                    }

                    if (themeData[subCmd]) {
                        applyTheme(subCmd);
                        print(`System Theme set to: [${subCmd.toUpperCase()}]`, 'text-green-500');
                    } else {
                        print(`Error: Theme '${subCmd}' not found. Type 'theme list' for options.`, 'text-error');
                    }
                }
            },
            'ls -l /': {
                desc: 'Lists main system directories (navigation links).',
                exec: () => {
                    print("drwxrwxr-x 4096 <span class='text-neonCyan'>home</span>", 'text-neonCyan');
                    print("drwxrwxr-x 4096 <span class='text-neonCyan'>about</span>", 'text-neonCyan');
                    print("drwxrwxr-x 4096 <span class='text-neonCyan'>work</span>", 'text-neonCyan');
                    print("drwxrwxr-x 4096 <span class='text-neonCyan'>contact</span>", 'text-neonCyan');
                }
            },
            'neofetch': {
                desc: 'Displays stylized system specifications (Host, Shell, Status).',
                exec: () => {
                    print('<span style="color:#8B5CF6">/\\_/\\</span>', 'text-gray-400');
                    print('<span style="color:#8B5CF6">( o.o )</span> <span class="text-neonCyan font-semibold">Host</span>: Vercel Cloud', 'text-gray-400');
                    print('<span style="color:#8B5CF6"> > ^ < </span> <span class="text-neonCyan font-semibold">Loc</span>: 127.0.0.1', 'text-gray-400');
                    print('       <span class="text-neonCyan font-semibold">Shell</span>: ZSH v5.8', 'text-gray-400');
                    print('       <span class="text-green-500 font-bold">● Online</span>');
                }
            },
            'date': {
                desc: 'Displays the current local date and time.',
                exec: () => {
                    print(new Date().toString(), 'text-neonCyan');
                }
            },
            'clear': {
                desc: 'Clears the terminal output screen.',
                exec: () => {
                    terminalOutput.innerHTML = '';
                }
            },
            'exit': {
                desc: 'Closes the terminal overlay.',
                exec: () => {
                    overlayTerminal.style.display = 'none';
                }
            },
            'help': {
                desc: 'Lists all available commands.',
                exec: () => {
                    print("Available Commands:", 'text-neonCyan');
                    Object.keys(commands).forEach(cmd => {
                        print(`  ${cmd.padEnd(15, ' ')} -> ${commands[cmd].desc}`, 'text-gray-400');
                    });
                    print("Navigation: cd home | cd work | cd contact", 'text-info');
                }
            },
            'ping': {
                desc: 'Simulates a network latency check.',
                exec: (args) => {
                    const host = args[1] || 'shashwat.dev';
                    print(`PING ${host} (${Math.random().toFixed(2)}): 64 bytes from ${host}: icmp_seq=1 time=${(Math.random() * 10).toFixed(2)} ms`, 'text-green-500');
                }
            },
            'grep': {
                desc: 'Searches the skills list for a keyword (e.g., grep react /skills).',
                exec: (args) => {
                    const term = (args[1] || '').toLowerCase();
                    const skills = "React, Next.js, Tailwind, HTML5, CSS3, C/C++, Node.js, Python, Django, PostgreSQL, Mongo, Redis, Docker, AWS, Git";
                    const results = skills.split(', ').filter(s => s.toLowerCase().includes(term));

                    if (term && results.length > 0) {
                        print(`Found matching skills: ${results.join(', ')}`, 'text-neonCyan');
                    } else if (term) {
                        print(`No skills found matching '${term}'.`, 'text-error');
                    } else {
                        print("Usage: grep [keyword] /skills", 'text-gray-400');
                    }
                }
            },
            'read -f /readme.txt': {
                desc: 'Prints a philosophy/future plans statement.',
                exec: () => {
                    print("##################################################", 'text-info');
                    print("// System Philosophy:", 'text-neonCyan');
                    print("// I believe software should be fast, reliable, and deeply intentional.", 'text-gray-400');
                    print("// Next Goal: Dive deep into WebAssembly and Rust for performance optimization.", 'text-gray-400');
                    print("##################################################", 'text-info');
                }
            },
            'sudo reboot': {
                desc: 'Initiates a simulated system reboot (redirects via confirmation).',
                exec: () => {
                    print("[SUDO] WARNING: System will restart. Proceed? (y/n)", 'text-error');
                    terminalInput.setAttribute('data-confirm', 'reboot');
                }
            },
            'reactor': {
                desc: 'Links the Cyber-Grid to ambient audio (Music/Voice).',
                exec: async () => {
                    try {
                        print("[INIT] Calibrating auditory sensors...", "text-yellow-500");
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        const source = audioCtx.createMediaStreamSource(stream);
                        const analyser = audioCtx.createAnalyser();
                        analyser.fftSize = 256;
                        source.connect(analyser);

                        const bufferLength = analyser.frequencyBinCount;
                        const dataArray = new Uint8Array(bufferLength);
                        const grid = document.querySelector('.cyber-grid');

                        print("[SUCCESS] Reactor Online. Play some music.", "text-green-500");

                        function renderFrame() {
                            requestAnimationFrame(renderFrame);
                            analyser.getByteFrequencyData(dataArray);

                            // Calculate average volume (Bass/Low-Mids focus)
                            let sum = 0;
                            for (let i = 0; i < 50; i++) { sum += dataArray[i]; }
                            const average = sum / 50;

                            // Map volume to CSS properties
                            // Opacity pulses, Scale zooms in/out slightly
                            const opacity = 0.1 + (average / 255) * 0.5;
                            const scale = 1 + (average / 1000);

                            if (grid) {
                                grid.style.opacity = opacity;
                                grid.style.transform = `scale(${scale})`;
                                // Optional: Change color based on intensity
                                if (average > 100) grid.style.setProperty('--grid-color', 'rgba(255, 0, 60, 0.4)'); // Red on drop
                                else grid.style.setProperty('--grid-color', 'rgba(102, 252, 241, 0.15)'); // Cyan default
                            }
                        }
                        renderFrame();
                    } catch (e) {
                        print("[ERROR] Audio access denied.", "text-red-500");
                    }
                }
            },
            'man': {
                desc: 'Displays the manual page for a command (e.g., man cd).',
                exec: (args) => {
                    const command = args[1];
                    if (command === 'cd') {
                        print("NAME: cd - Change the active directory/section.", 'text-neonCyan');
                        print("SYNOPSIS: cd [home|about|work|contact]", 'text-gray-400');
                    } else if (commands[command]) {
                        print(`MANUAL: ${command} -> ${commands[command].desc}`, 'text-neonCyan');
                    } else {
                        print("Error: No manual entry for command.", 'text-error');
                    }
                }
            },
            'rm -rf /': {
                desc: 'WARNING: INITIATES SYSTEM PURGE.',
                exec: () => {
                    print("WARNING: ROOT DELETION INITIATED...", "text-red-600 font-bold animate-pulse");
                    print("Are you sure? This cannot be undone.", "text-red-600");

                    setTimeout(() => {
                        const allElements = document.body.querySelectorAll('*');
                        const total = allElements.length;
                        let count = 0;

                        // Nuke sound
                        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                        const interval = setInterval(() => {
                            if (count >= total) {
                                clearInterval(interval);
                                document.body.innerHTML = '<div style="height:100vh;background:black;display:flex;align-items:center;justify-content:center;color:red;font-family:monospace;">SYSTEM_OFFLINE</div>';
                                return;
                            }

                            // Randomly select an element to delete
                            const target = allElements[Math.floor(Math.random() * total)];
                            if (target && target.parentNode) {
                                target.style.transition = "all 0.1s";
                                target.style.transform = "scale(0) rotate(20deg)";
                                target.style.opacity = "0";
                                setTimeout(() => target.remove(), 100);

                                // Zapping Sound
                                if (count % 5 === 0) { // Don't play on every single one (too loud)
                                    const osc = audioCtx.createOscillator();
                                    const gain = audioCtx.createGain();
                                    osc.connect(gain);
                                    gain.connect(audioCtx.destination);
                                    osc.type = 'sawtooth';
                                    osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                                    osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);
                                    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                                    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
                                    osc.start();
                                    osc.stop(audioCtx.currentTime + 0.1);
                                }
                            }
                            count++;
                        }, 10); // Very fast deletion
                    }, 2000);
                }
            },
            'ssh': {
                desc: 'Simulates a secure connection attempt.',
                exec: () => {
                    print("Handshake initiated...", 'text-info');
                    setTimeout(() => {
                        print("SUCCESS: Connection to api.shash.dev Established.", 'text-green-500');
                        scrollToBottom();
                    }, 500);
                }
            },
        };

        // --- Command Runner ---

        function runCommand(command) {
            if (!command) return;

            const parts = command.trim().toLowerCase().split(/\s+/);
            const baseCommand = parts[0];

            if (baseCommand === 'cd' && parts.length === 2) {
                const dir = parts[1];
                let url = '';
                if (dir === 'home') url = 'home.html';
                else if (dir === 'about') url = 'about.html';
                else if (dir === 'work' || dir === 'projects') url = 'projects.html';
                else if (dir === 'contact' || dir === 'comm') url = 'contact.html';

                if (url) {
                    print(`Navigating to /${dir} ...`, 'text-info');
                    setTimeout(() => window.location.href = url, 300);
                    return;
                }
            }

            // Handle complex commands (e.g., 'read -f /README.txt' or 'ls -l /')
            const complexCommand = command.trim().toLowerCase();
            if (commands[complexCommand]) {
                commands[complexCommand].exec(parts);
                return;
            }

            if (commands[baseCommand]) {
                commands[baseCommand].exec(parts);
                return;
            }

            print(`Error: command not found: ${command}`, 'text-error');
        }

        // --- Input and Confirmation Handler ---

        terminalInput.addEventListener('keydown', (e) => {
            // HISTORY NAVIGATION
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    terminalInput.value = commandHistory[historyIndex];
                } else if (historyIndex === -1 && commandHistory.length > 0) {
                    historyIndex = commandHistory.length - 1;
                    terminalInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1 && historyIndex !== -1) {
                    historyIndex++;
                    terminalInput.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    terminalInput.value = '';
                }
            }
            // EXECUTION
            else if (e.key === 'Enter') {
                e.preventDefault();
                const command = terminalInput.value.trim();
                const confirmState = terminalInput.getAttribute('data-confirm');

                if (command) {
                    commandHistory.push(command);
                    historyIndex = commandHistory.length;
                }

                echoInput(command);

                if (confirmState === 'reboot') {
                    if (command === 'y') {
                        print("System rebooting...", 'text-error');
                        setTimeout(() => window.location.href = 'loading.html', 500);
                    } else {
                        print("Reboot cancelled.", 'text-green-500');
                    }
                    terminalInput.removeAttribute('data-confirm');
                } else {
                    runCommand(command);
                }

                terminalInput.value = '';
                scrollToBottom();
            }
        });

        // --- Drag and Resize Logic ---
        const termHeader = document.getElementById('term-header');
        let isDragging = false;
        let offsetX, offsetY;

        termHeader.addEventListener('mousedown', (e) => {
            isDragging = true;
            const rect = overlayTerminal.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;

            overlayTerminal.style.cursor = 'move';
            overlayTerminal.style.position = 'fixed';
            overlayTerminal.style.right = 'auto';
            overlayTerminal.style.bottom = 'auto';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            if (newX < 0) newX = 0;
            if (newY < 0) newY = 0;
            if (newX + overlayTerminal.offsetWidth > window.innerWidth) newX = window.innerWidth - overlayTerminal.offsetWidth;
            if (newY + overlayTerminal.offsetHeight > window.innerHeight) newY = window.innerHeight - overlayTerminal.offsetHeight;

            overlayTerminal.style.left = newX + 'px';
            overlayTerminal.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            overlayTerminal.style.cursor = 'default';
        });

        // --- Toggle Button Logic ---
        toggleButton.addEventListener('click', () => {
            const isHidden = overlayTerminal.style.display === 'none';
            overlayTerminal.style.display = isHidden ? 'flex' : 'none';
            if (isHidden) {
                terminalInput.focus();
            }
        });

        // --- Initial Setup and Event Handling ---

        // Existing theme toggle logic (Icon Click)
        const themeBtn = document.getElementById('theme-toggle');
        const html = document.documentElement;
        themeBtn.addEventListener('click', () => {
            if (localStorage.customTheme && localStorage.customTheme !== 'default' && localStorage.customTheme !== 'light') {
                applyTheme('default');
            }
            html.classList.toggle('dark');
            const isDark = html.classList.contains('dark');
            localStorage.theme = isDark ? 'dark' : 'light';

            if (isDark) applyTheme('default');
            else applyTheme('light');

            themeBtn.querySelector('.ri-sun-line').classList.toggle('hidden', isDark);
            themeBtn.querySelector('.ri-moon-line').classList.toggle('hidden', !isDark);
        });

        // Function to update clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toUTCString().split(' ')[4] + ' UTC';
        }
        setInterval(updateClock, 1000);

        // Spotlight/Glow Logic
        const grid = document.querySelector('.cyber-grid');
        const contactPage = document.getElementById('contact-page');
        const mainFooter = document.getElementById('main-footer');
        const body = document.body;

        function activateGlow() { body.classList.add('is-hovering'); }
        function deactivateGlow() { body.classList.remove('is-hovering'); }

        const glowSections = [contactPage, mainFooter].filter(el => el != null);

        glowSections.forEach(section => {
            section.addEventListener('mouseenter', activateGlow);
        });

        document.addEventListener('mouseout', function (e) {
            if (!e.relatedTarget && !e.toElement) {
                deactivateGlow();
            }
        });

        window.addEventListener('mousemove', (e) => {
            if (grid) {
                grid.style.setProperty('--x', `${e.clientX}px`);
                grid.style.setProperty('--y', `${e.clientY}px`);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateClock();

            // Theme Icon
            const isDark = html.classList.contains('dark');
            themeBtn.querySelector('.ri-sun-line').classList.toggle('hidden', isDark);
            themeBtn.querySelector('.ri-moon-line').classList.toggle('hidden', !isDark);

            // --- PARTICLES ---
            const cursorCanvas = document.createElement('canvas');
            const cursorCtx = cursorCanvas.getContext('2d');
            cursorCanvas.style.position = 'fixed';
            cursorCanvas.style.top = '0';
            cursorCanvas.style.left = '0';
            cursorCanvas.style.width = '100%';
            cursorCanvas.style.height = '100%';
            cursorCanvas.style.pointerEvents = 'none';
            cursorCanvas.style.zIndex = '9998';
            document.body.appendChild(cursorCanvas);

            let cursorParticles = [];

            function resizeCursorCanvas() {
                cursorCanvas.width = window.innerWidth;
                cursorCanvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCursorCanvas);
            resizeCursorCanvas();

            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 3 + 1;
                    this.speedX = Math.random() * 2 - 1;
                    this.speedY = Math.random() * 2 - 1;
                    this.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
                    this.life = 1.0;
                }
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life -= 0.02;
                    if (this.size > 0.1) this.size -= 0.1;
                }
                draw() {
                    cursorCtx.fillStyle = this.color;
                    cursorCtx.globalAlpha = this.life;
                    cursorCtx.fillRect(this.x, this.y, this.size, this.size);
                    cursorCtx.globalAlpha = 1.0;
                }
            }

            window.addEventListener('mousemove', (e) => {
                cursorParticles.push(new Particle(e.clientX, e.clientY));
                cursorParticles.push(new Particle(e.clientX, e.clientY));
            });

            function animateParticles() {
                cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
                for (let i = 0; i < cursorParticles.length; i++) {
                    cursorParticles[i].update();
                    cursorParticles[i].draw();
                    if (cursorParticles[i].life <= 0) {
                        cursorParticles.splice(i, 1);
                        i--;
                    }
                }
                requestAnimationFrame(animateParticles);
            }
            animateParticles();

            // --- INPUT HAPTICS ---
            document.querySelectorAll('input, textarea, button').forEach(el => {
                el.addEventListener('focus', () => { if (navigator.vibrate) navigator.vibrate(10); });
                el.addEventListener('click', () => { if (navigator.vibrate) navigator.vibrate(15); });
            });
        });

        // --- Shared Terminal Logic (ENDS HERE) ---
        // --- HACKER TEXT DECODE EFFECT ---
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%^&*";

        function hackerEffect(event) {
            const target = event.target;
            // Store original text if not already stored
            if (!target.dataset.value) target.dataset.value = target.innerText;

            let iteration = 0;
            const originalText = target.dataset.value;

            clearInterval(target.interval);

            target.interval = setInterval(() => {
                target.innerText = originalText
                    .split("")
                    .map((letter, index) => {
                        if (index < iteration) {
                            return originalText[index];
                        }
                        return letters[Math.floor(Math.random() * 62)];
                    })
                    .join("");

                if (iteration >= originalText.length) {
                    clearInterval(target.interval);
                }

                iteration += 1 / 3; // Controls speed (higher = faster)
            }, 30);
        }

        // Apply to all Section Headings (h2)
        document.querySelectorAll('h2').forEach(header => {
            header.addEventListener('mouseover', hackerEffect);
        });
        // --- AUDIO SYSTEM (Synthesized Sounds) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'hover') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'click') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.15);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.15);
            }
        }

        // Apply to all interactive elements
        document.querySelectorAll('a, button, .terminal-card').forEach(el => {
            el.addEventListener('mouseenter', () => playSound('hover'));
            el.addEventListener('click', () => playSound('click'));
        });
        // --- 3D TILT EFFECT ---
        document.querySelectorAll('.terminal-card').forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Calculate rotation (max 15 degrees)
                const xRot = -1 * ((y - rect.height / 2) / rect.height * 15);
                const yRot = (x - rect.width / 2) / rect.width * 15;

                card.style.transform = `perspective(1000px) rotateX(${xRot}deg) rotateY(${yRot}deg) scale(1.02)`;
                card.style.zIndex = '10';
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
                card.style.zIndex = '1';
            });
        });
        // --- KONAMI CODE EASTER EGG ---
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        document.addEventListener('keydown', (e) => {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    activateOverrideMode();
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        });

        function activateOverrideMode() {
            // 1. Play Alert Sound
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);

            osc.start();
            osc.stop(audioCtx.currentTime + 1);

            // 2. Change Theme to Red Alert
            document.documentElement.style.setProperty('--accent-primary', '#ff0000');
            document.documentElement.style.setProperty('--accent-secondary', '#ff4d00');
            document.documentElement.style.setProperty('--text-primary', '#ffcccc');

            // 3. Inject Warning Modal
            const warning = document.createElement('div');
            warning.className = 'fixed inset-0 flex items-center justify-center bg-black/90 z-[10000] text-red-500 font-mono text-4xl font-bold animate-pulse';
            warning.innerText = "SYSTEM OVERRIDE: ROOT ACCESS GRANTED";
            document.body.appendChild(warning);

            setTimeout(() => {
                warning.remove();
                alert("Welcome, Admin. Hidden features unlocked.");
            }, 2000);
        }
        // --- POWER MODE INPUT SHAKE ---
        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', function () {
                // Random shake offsets
                const x = Math.random() * 4 - 2;
                const y = Math.random() * 4 - 2;

                this.style.transform = `translate(${x}px, ${y}px)`;
                this.style.borderColor = 'var(--accent-primary)';

                // Reset after 100ms
                setTimeout(() => {
                    this.style.transform = 'translate(0, 0)';
                    this.style.borderColor = '';
                }, 100);
            });
        });
        // --- MECHANICAL KEYBOARD SFX ---
        function playKeyClick() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            // Create a short, sharp "click" using a high frequency burst
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.type = 'triangle';
            // Randomize slightly for realism
            osc.frequency.setValueAtTime(600 + Math.random() * 200, audioCtx.currentTime);

            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        document.addEventListener('keydown', playKeyClick);
        // --- SYSTEM SLEEP MODE ---
        let idleTimer;
        const sleepOverlay = document.getElementById('sleep-mode');

        function resetIdleTimer() {
            clearTimeout(idleTimer);
            if (sleepOverlay) {
                sleepOverlay.style.opacity = '0';
                sleepOverlay.classList.add('hidden');
                sleepOverlay.style.pointerEvents = 'none'; // Allow clicks to pass through
            }

            // Set idle time (e.g., 10 seconds)
            idleTimer = setTimeout(() => {
                if (sleepOverlay) {
                    sleepOverlay.classList.remove('hidden');
                    // Small delay to allow display:block to apply before opacity transition
                    setTimeout(() => {
                        sleepOverlay.style.opacity = '0.9';
                        sleepOverlay.style.pointerEvents = 'all'; // Block clicks
                    }, 50);
                }
            }, 10000);
        }

        // Reset on any interaction
        window.addEventListener('mousemove', resetIdleTimer);
        window.addEventListener('keydown', resetIdleTimer);
        window.addEventListener('scroll', resetIdleTimer);
        resetIdleTimer(); // Start immediately
        // --- PARALLAX GRID EFFECT ---
        const parallaxGrid = document.querySelector('.cyber-grid');

        document.addEventListener('mousemove', (e) => {
            if (!parallaxGrid) return;

            // Calculate movement (divided by 50 to make it subtle)
            const x = (window.innerWidth - e.pageX * 2) / 50;
            const y = (window.innerHeight - e.pageY * 2) / 50;

            parallaxGrid.style.transform = `translate(${x}px, ${y}px)`;
        });
        // --- VOICE COMMAND PROTOCOL (V.C.P) ---
        // Checks browser support (Chrome/Edge mostly)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            // Create a visual mic indicator
            const micIcon = document.createElement('div');
            micIcon.className = 'fixed bottom-5 left-5 z-[1000] text-gray-600 cursor-pointer transition-colors duration-300';
            micIcon.innerHTML = '<i class="ri-mic-off-line text-2xl"></i>';
            document.body.appendChild(micIcon);

            micIcon.addEventListener('click', () => {
                try { recognition.start(); } catch (e) { recognition.stop(); }
            });

            recognition.onstart = () => {
                micIcon.innerHTML = '<i class="ri-mic-line text-2xl animate-pulse text-red-500"></i>';
                print("[V.C.P] Listening...", 'text-yellow-500'); // Print to your terminal
            };

            recognition.onend = () => {
                micIcon.innerHTML = '<i class="ri-mic-off-line text-2xl"></i>';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                print(`> Voice Input: "${transcript}"`, 'text-neonCyan');

                // Command Logic
                if (transcript.includes('home')) { window.location.href = 'home.html'; }
                else if (transcript.includes('project') || transcript.includes('work')) { window.location.href = 'projects.html'; }
                else if (transcript.includes('contact')) { window.location.href = 'contact.html'; }
                else if (transcript.includes('theme matrix')) { applyTheme('matrix'); }
                else if (transcript.includes('theme cyberpunk')) { applyTheme('cyberpunk'); }
                else if (transcript.includes('system status')) {
                    document.getElementById('terminal-toggle').click();
                    runCommand('neofetch');
                }
            };
        } else {
            console.log("Voice API not supported in this browser.");
        }
        // --- MAGNETIC GRAVITY UI ---
        const magneticElements = document.querySelectorAll('button, a.px-6'); // Targets main buttons

        magneticElements.forEach(el => {
            el.addEventListener('mousemove', (e) => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                // "Pull" factor (higher = stronger pull)
                el.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
                el.style.transition = 'transform 0.1s ease-out';
            });

            el.addEventListener('mouseleave', () => {
                el.style.transform = 'translate(0px, 0px)';
                el.style.transition = 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)'; // Bouncy reset
            });
        });
        // --- DYNAMIC FAVICON GENERATOR ---
        const faviconCanvas = document.createElement('canvas');
        faviconCanvas.width = 32;
        faviconCanvas.height = 32;
        const faviconCtx = faviconCanvas.getContext('2d');
        const link = document.querySelector("link[rel~='icon']") || document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);

        function updateFavicon() {
            // Clear
            faviconCtx.clearRect(0, 0, 32, 32);

            // Get current theme accent color
            const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim() || '#00ff00';

            // Draw a "System Dot"
            faviconCtx.fillStyle = '#000000';
            faviconCtx.fillRect(0, 0, 32, 32); // Background

            faviconCtx.fillStyle = accent;
            faviconCtx.beginPath();
            faviconCtx.arc(16, 16, 10, 0, Math.PI * 2);
            faviconCtx.fill();

            // Add a blinking inner light
            if (new Date().getSeconds() % 2 === 0) {
                faviconCtx.fillStyle = '#ffffff';
                faviconCtx.beginPath();
                faviconCtx.arc(16, 16, 4, 0, Math.PI * 2);
                faviconCtx.fill();
            }

            link.href = faviconCanvas.toDataURL();
        }

        // Update every second
        setInterval(updateFavicon, 1000);
        // --- SINGULARITY: BIO-METRIC ENERGY LINK ---
        if ('getBattery' in navigator) {
            navigator.getBattery().then(battery => {
                function updateEnergyState() {
                    const level = battery.level * 100;
                    const isCharging = battery.charging;

                    if (level <= 20 && !isCharging) {
                        // EMERGENCY MODE
                        document.documentElement.style.filter = 'grayscale(0.8) brightness(0.6)';
                        document.body.classList.add('low-power');
                        if (!window.hasWarnedLowPower) {
                            print(`[WARNING] MAIN POWER CRITICAL (${Math.round(level)}%). ENGAGING POWER SAVING.`, 'text-red-500 animate-pulse');
                            window.hasWarnedLowPower = true;
                        }
                    } else {
                        // NORMAL MODE
                        document.documentElement.style.filter = 'none';
                        document.body.classList.remove('low-power');
                        if (window.hasWarnedLowPower && isCharging) {
                            print(`[SYSTEM] EXTERNAL POWER DETECTED. SYSTEMS NORMALIZING.`, 'text-green-500');
                            playSound('hover'); // Reuse your synth sound
                            window.hasWarnedLowPower = false;
                        }
                    }
                }

                battery.addEventListener('levelchange', updateEnergyState);
                battery.addEventListener('chargingchange', updateEnergyState);
                updateEnergyState(); // Initial check
            });
        }
        // --- SINGULARITY: STEALTH MODE (PANIC SWITCH) ---
        let escCount = 0;
        let escTimer;

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                escCount++;
                clearTimeout(escTimer);
                escTimer = setTimeout(() => escCount = 0, 500); // Reset if too slow

                if (escCount === 3) {
                    activateStealthMode();
                    escCount = 0;
                }
            }
        });

        function activateStealthMode() {
            document.title = "Quarterly_Report_2025.xlsx - Excel";
            // Nuke the body content
            document.body.innerHTML = `
        <div style="font-family: Arial, sans-serif; padding: 20px; background: #fff; color: #000; height: 100vh;">
            <div style="background: #217346; color: white; padding: 10px; font-weight: bold;">Microsoft Excel</div>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px;">
                <tr style="background: #f3f3f3;">
                    <th style="border: 1px solid #ccc; padding: 5px;">A</th>
                    <th style="border: 1px solid #ccc; padding: 5px;">B</th>
                    <th style="border: 1px solid #ccc; padding: 5px;">C</th>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">1</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Revenue</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">$1,204,500</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">2</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Growth</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">12.5%</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">3</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Q4 Target</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Pending</td>
                </tr>
            </table>
            <div style="margin-top: 50px; color: #666;">Press F5 to Reload System</div>
        </div>
    `;
            // Kill all sounds
            if (window.audioCtx) window.audioCtx.close();
        }
        // --- GAMEPAD CONTROL PROTOCOL ---
        let gamepadLoop;

        window.addEventListener("gamepadconnected", (e) => {
            const gpIndex = e.gamepad.index;
            const alertBox = document.createElement('div');
            alertBox.className = 'fixed top-5 left-1/2 transform -translate-x-1/2 bg-neonBlue text-black px-4 py-2 font-mono text-sm z-[10000] rounded shadow-[0_0_15px_var(--accent-primary)]';
            alertBox.innerText = "🎮 CONTROLLER DETECTED: ENGAGING DRIVE MODE";
            document.body.appendChild(alertBox);
            setTimeout(() => alertBox.remove(), 3000);

            // Start polling
            gamepadLoop = setInterval(() => {
                const gp = navigator.getGamepads()[gpIndex];
                if (!gp) return;

                // Right Stick Y-Axis (Scroll)
                if (Math.abs(gp.axes[3]) > 0.2) {
                    window.scrollBy(0, gp.axes[3] * 20); // Speed factor
                }

                // Button A (Bottom Button) - Trigger Click on center element
                if (gp.buttons[0].pressed) {
                    // Find element in center of screen
                    const x = window.innerWidth / 2;
                    const y = window.innerHeight / 2;
                    const el = document.elementFromPoint(x, y);
                    if (el) el.click();
                }

                // Button B (Right Button) - Go Back/Top
                if (gp.buttons[1].pressed) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 16); // 60 FPS
        });

        window.addEventListener("gamepaddisconnected", () => {
            clearInterval(gamepadLoop);
        });
        // --- AMBIENT LIGHT REACTOR ---
        if ('AmbientLightSensor' in window) {
            try {
                const sensor = new AmbientLightSensor();
                sensor.addEventListener('reading', () => {
                    const lux = sensor.illuminance;
                    const root = document.documentElement;

                    if (lux < 10) {
                        // Pitch black room -> Max Glow
                        root.style.setProperty('--grid-opacity', '0.5');
                        root.style.setProperty('--text-shadow', '0 0 10px var(--accent-primary)');
                    } else if (lux > 500) {
                        // Bright Sun -> High Contrast / Dim Glow
                        root.style.setProperty('--grid-opacity', '0.1');
                        root.style.setProperty('--text-shadow', 'none');
                    }
                });
                sensor.start();
            } catch (err) {
                console.log("Light sensor blocked by permissions policy.");
            }
        }
        console.log(
            "%c STOP! %c \nAuthorized personnel only. \nAll actions are being logged.",
            "color: red; font-size: 50px; font-weight: bold; text-shadow: 2px 2px black;",
            "color: #66fcf1; font-family: monospace; font-size: 14px;"
        );
        console.log(
            "%c      _    _      \n     | |  | |     \n  ___| |__| |__   \n / __|  __  |\\ \\  \n \\__ \\ |  | |/ /  \n |___/_|  |_/_/   \n",
            "color: #3b82f6; font-weight: bold;"
        );
        // --- PERSISTENT MEMORY CORE ---
        function saveSystemState() {
            const state = {
                theme: localStorage.customTheme || 'default',
                commandsRun: commandHistory.length,
                adminUnlocked: window.isAdmin || false,
                lastLogin: Date.now()
            };
            localStorage.setItem('system_core_memory', JSON.stringify(state));
        }

        function loadSystemState() {
            const memory = JSON.parse(localStorage.getItem('system_core_memory'));
            if (memory) {
                // Restore Theme
                if (memory.theme) applyTheme(memory.theme);

                // Welcome message based on time
                const days = Math.floor((Date.now() - memory.lastLogin) / (1000 * 60 * 60 * 24));
                if (days > 0) {
                    print(`Welcome back, User. It has been ${days} days since last login.`, "text-neonBlue");
                } else {
                    print("Session restored. Welcome back.", "text-neonBlue");
                }
            }
        }

        // Hook into your 'exit' or 'beforeunload' event
        window.addEventListener('beforeunload', saveSystemState);
        // Hook into load
        window.addEventListener('DOMContentLoaded', loadSystemState);
        // --- DOM INTEGRITY WATCHDOG ---
        const essentialIDs = ['hero-section', 'terminal-toggle', 'main-footer'];

        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.removedNodes.length > 0) {
                    mutation.removedNodes.forEach(node => {
                        if (node.id && essentialIDs.includes(node.id)) {
                            // ALERT!
                            const audio = new AudioContext(); // fast beep
                            // (Insert your beep code here)

                            alert("⚠️ CRITICAL ERROR: CORE COMPONENT DELETED.\nINITIATING EMERGENCY REFRESH.");
                            location.reload(); // Force reload to "repair"
                        }
                    });
                }
            });
        });

        observer.observe(document.body, { childList: true, subtree: true });
        // --- BULLET TIME PROTOCOL ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Shift') {
                document.body.style.transition = 'all 0.5s ease';
                // Force hardware acceleration on everything
                document.documentElement.style.setProperty('--time-scale', '0.1');

                // This is the magic CSS injection
                const css = `* { animation-duration: 10s !important; transition-duration: 2s !important; }`;
                const style = document.createElement('style');
                style.id = 'bullet-time-css';
                style.innerText = css;
                document.head.appendChild(style);

                // Play "Power Down" sound
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
                osc.start(); osc.stop(audioCtx.currentTime + 1);
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'Shift') {
                const style = document.getElementById('bullet-time-css');
                if (style) style.remove();
                document.documentElement.style.removeProperty('--time-scale');
            }
        });
        // --- NEURAL VOICE MODULE ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                utterance.voice = voices.find(v => v.name.includes('Google US English')) || voices[0];
                utterance.pitch = 0.8;
                utterance.rate = 1.1;
                utterance.volume = 0.5;
                window.speechSynthesis.speak(utterance);
            }
        }
        /* =========================================
   === 1. VS CODE STYLE MINIMAP LOGIC ===
========================================= */
        function drawMinimap() {
            const c = document.getElementById('minimap-canvas');
            if (!c) return;
            const ctx = c.getContext('2d');

            // High-DPI Support for crisp lines
            const dpr = window.devicePixelRatio || 1;
            // Get container dimensions
            const parent = c.parentElement;
            c.width = parent.clientWidth * dpr;
            c.height = parent.clientHeight * dpr;
            ctx.scale(dpr, dpr);

            // VS Code Syntax Colors (Blue, Orange, Green, Purple, Light Blue)
            const syntaxColors = ['#569cd6', '#ce9178', '#6a9955', '#c586c0', '#4fc1ff', '#dcdcaa'];

            let y = 10;
            const width = parent.clientWidth;

            // Generate "Code Blocks"
            while (y < parent.clientHeight) {
                // Randomly skip lines (paragraph breaks)
                if (Math.random() > 0.85) { y += 6; continue; }

                let x = 5; // Left padding
                let indent = Math.floor(Math.random() * 3) * 10; // Random indentation
                x += indent;

                // Draw words in a line
                while (x < width - 10) {
                    // Random word length (short to medium)
                    const wordLen = Math.random() * 25 + 5;
                    // Pick a syntax color
                    const color = syntaxColors[Math.floor(Math.random() * syntaxColors.length)];

                    ctx.fillStyle = color;
                    ctx.globalAlpha = 0.7; // VS Code minimap is slightly faded
                    ctx.fillRect(x, y, wordLen, 3); // Draw the "word" rectangle

                    x += wordLen + 4; // Space between words

                    // Randomly end the line
                    if (Math.random() > 0.8) break;
                }
                y += 5; // Line spacing
            }
        }

        /* =========================================
           === 2. VERTICAL TERMINAL RESIZER ===
        ========================================= */
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Minimap
            drawMinimap();

            // Initialize Resizer
            const resizer = document.getElementById('term-resizer');
            const terminal = document.getElementById('ide-terminal');
            const editorWindow = document.querySelector('.ide-window'); // Main container

            if (!resizer || !terminal) return;

            let isResizing = false;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                resizer.classList.add('resizing');
                document.body.style.cursor = 'row-resize'; // Global cursor change
                e.preventDefault(); // Prevent text selection while dragging
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                // Calculate new height
                // Formula: Bottom of Window - Mouse Y Position - Footer Height (Status Bar ~22px)
                const windowRect = editorWindow.getBoundingClientRect();
                const newHeight = windowRect.bottom - e.clientY - 25;

                // Constraints (Min 50px, Max 400px)
                if (newHeight > 50 && newHeight < 400) {
                    terminal.style.height = `${newHeight}px`;
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizer.classList.remove('resizing');
                    document.body.style.cursor = 'default';
                }
            });

            // Redraw minimap if window resizes
            window.addEventListener('resize', drawMinimap);
        });
        // --- CONSOLE TABS LOGIC ---

        // --- FOLDER LOGIC ---

        function toggleFolder(folderId, headerEl) {
            const content = document.getElementById(folderId);
            const icon = headerEl.querySelector('i');

            // Toggle Visibility
            if (content.classList.contains('hidden')) {
                // OPEN IT
                content.classList.remove('hidden');
                icon.className = 'ri-arrow-down-s-line';
            } else {
                // CLOSE IT
                content.classList.add('hidden');
                icon.className = 'ri-arrow-right-s-line';
            }
        }

        function openDummy(fileName) {
            // 1. Switch to Output Tab to show the "action"
            switchConsoleTab('out');

            // 2. Log the action using the function we made earlier
            logToOutput(`Opening binary file: ${fileName}...`);

            // 3. Simulate a read delay
            setTimeout(() => {
                logToOutput(`[System] File '${fileName}' is read-only in guest mode.`, 'text-yellow-500');
            }, 400);
        }

        // 1. Switch Tabs
        function switchConsoleTab(tabName) {
            // UI: Update Header Classes
            document.querySelectorAll('.term-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // UI: Show/Hide Panes
            document.querySelectorAll('.console-pane').forEach(p => p.classList.add('hidden'));
            document.getElementById(`pane-${tabName}`).classList.remove('hidden');

            // Focus input if debug selected
            if (tabName === 'debug') document.getElementById('debug-cmd').focus();
        }

        // 2. Debug Console Interaction (The "Working" Part)
        const debugInput = document.getElementById('debug-cmd');
        const debugLog = document.getElementById('debug-log');

        debugInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const cmd = debugInput.value.trim();
                if (!cmd) return;

                // Echo the command
                debugLog.innerHTML += `<div class="mt-1"><span class="text-blue-500">>></span> <span class="text-gray-300">${cmd}</span></div>`;

                // Process Command
                let response = '';
                try {
                    if (cmd === 'help') {
                        response = `<span class="text-yellow-500">Available vars:</span> formValues, currentLang, navigator<br><span class="text-yellow-500">Commands:</span> clear, theme`;
                    } else if (cmd === 'clear') {
                        debugLog.innerHTML = '';
                        debugInput.value = '';
                        return;
                    } else if (cmd === 'formValues' || cmd === 'form') {
                        // Show live data from the form inputs
                        response = `<span class="text-green-400">${JSON.stringify(formValues, null, 2)}</span>`;
                    } else if (cmd === 'navigator') {
                        response = `<span class="text-orange-400">UserAgent: ${navigator.userAgent}</span>`;
                    } else {
                        // Safe eval for other simple math/strings
                        response = `<span class="text-gray-400">${eval(cmd)}</span>`;
                    }
                } catch (err) {
                    response = `<span class="text-red-500">ReferenceError: ${cmd} is not defined</span>`;
                }

                debugLog.innerHTML += `<div class="pl-4 mb-2">${response}</div>`;
                debugLog.scrollTop = debugLog.scrollHeight;
                debugInput.value = '';
            }
        });

        // 3. Update Deploy to write to OUTPUT tab as well
        // (Paste this OVER your existing update inside deploy() function)
        function logToOutput(msg, type = 'info') {
            const outPane = document.getElementById('pane-out');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            const color = type === 'error' ? 'text-red-500' : type === 'success' ? 'text-green-400' : 'text-gray-400';
            outPane.innerHTML += `<div><span class="text-gray-600">[${time}]</span> <span class="${color}">${msg}</span></div>`;
            outPane.scrollTop = outPane.scrollHeight;
        }
        // --- COMMAND PALETTE LOGIC ---
        const palette = document.getElementById('cmd-palette');
        const cmdInput = document.getElementById('cmd-input');
        const cmdList = document.getElementById('cmd-list');

        // Define Commands
        const sysCommands = [
            { label: 'Deploy Application', key: 'Ctrl+Enter', action: () => deploy() },
            { label: 'Clear Terminal', key: '', action: () => document.getElementById('pane-term').innerHTML = '' },
            { label: 'Format Document', key: 'Shift+Alt+F', action: () => formatInputs() },
            { label: 'Theme: Matrix', key: '', action: () => applyTheme('matrix') },
            { label: 'Theme: Cyberpunk', key: '', action: () => applyTheme('cyberpunk') },
            { label: 'Theme: Default', key: '', action: () => applyTheme('default') },
            { label: 'File: Save', key: 'Ctrl+S', action: () => logToOutput('File saved locally.') },
            { label: 'Go to Home', key: '', action: () => window.location.href = 'home.html' },
            { label: 'System: Self Destruct', key: 'Ctrl+Alt+D', action: () => runCommand('rm -rf /') },
        ];

        function togglePalette(show) {
            if (show) {
                palette.classList.remove('hidden');
                cmdInput.value = '';
                renderCommands(sysCommands);
                cmdInput.focus();
            } else {
                palette.classList.add('hidden');
            }
        }

        function renderCommands(list) {
            cmdList.innerHTML = list.map(cmd => `
        <div class="cmd-item" onclick="execCmd('${cmd.label}')">
            <span>${cmd.label}</span>
            <span class="cmd-key">${cmd.key}</span>
        </div>
    `).join('');
        }

        function execCmd(label) {
            const cmd = sysCommands.find(c => c.label === label);
            if (cmd) cmd.action();
            togglePalette(false);
        }

        function formatInputs() {
            // Trim whitespace from inputs
            document.querySelectorAll('.ide-input').forEach(i => i.value = i.value.trim());
            logToOutput('Document formatted.');
        }

        // Event Listeners
        document.addEventListener('keydown', (e) => {
            // Open on Ctrl+Shift+P OR F1
            if ((e.ctrlKey && e.shiftKey && e.key === 'P') || e.key === 'F1') {
                e.preventDefault();
                togglePalette(true);
            }
            // Close on Escape
            if (e.key === 'Escape') togglePalette(false);
        });

        // Filter Logic
        cmdInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = sysCommands.filter(c => c.label.toLowerCase().includes(term));
            renderCommands(filtered);
        });
    </script>
    <div id="cmd-palette" class="fixed inset-0 bg-black/50 z-[9999] hidden flex justify-center pt-[10vh]"
        onclick="togglePalette(false)">
        <div class="w-[600px] max-w-[90%] bg-[#252526] border border-[#454545] shadow-2xl rounded-md overflow-hidden flex flex-col h-max max-h-[50vh]"
            onclick="event.stopPropagation()">

            <div class="p-2 border-b border-[#454545] flex items-center gap-2">
                <span class="text-gray-400">></span>
                <input id="cmd-input" type="text"
                    class="bg-transparent border-none outline-none text-white w-full font-mono text-sm"
                    placeholder="Type a command...">
            </div>

            <div id="cmd-list" class="overflow-y-auto py-1">
            </div>
        </div>
    </div>
</body>

</html>