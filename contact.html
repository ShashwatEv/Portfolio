<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shashwat | Initialize Comm</title>
    <link rel="icon" type="image/png" href="/assets/fevicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Space+Grotesk:wght@300;500;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Space Grotesk', 'sans-serif'], mono: ['Fira Code', 'monospace'] },
                    colors: {
                        // Mapped to CSS Variables for Terminal Switching
                        bgDark: 'var(--bg-primary)',
                        textMain: 'var(--text-primary)',
                        neonCyan: 'var(--accent-primary)',
                        neonBlue: 'var(--accent-secondary)',
                    },
                    animation: { 'infinite-scroll': 'infinite-scroll 25s linear infinite' },
                    keyframes: {
                        'infinite-scroll': {
                            from: { transform: 'translateX(0)' },
                            to: { transform: 'translateX(-100%)' },
                        }
                    }
                }
            }
        }
    </script>

    <script>
            
                // Check for saved custom theme or default to system
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            
    </script>

    <style>
        /* --- DYNAMIC THEME VARIABLES --- */
        :root {
            /* Default Theme (Original Dark) */
            --bg-primary: #050505;
            --text-primary: #e5e5e5;
            --accent-primary: #66fcf1;
            /* Cyan */
            --accent-secondary: #3b82f6;
            /* Blue */
            --grid-color: rgba(102, 252, 241, 0.15);
        }

        /* Smooth Transition for Theme Switching */
        body,
        div,
        section,
        nav,
        footer,
        span,
        h1,
        h2,
        h3,
        p,
        i,
        button,
        input,
        textarea,
        label {
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }

        /* BASE STYLES & SPOTLIGHT FIX */
        html {
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        body {
            overflow-x: hidden;
        }

        /* CYBER GRID */
        .cyber-grid {
            position: fixed;
            inset: 0;
            z-index: 0;
            background-image: none;
            background-size: 40px 40px;
            mask-image: none;
            -webkit-mask-image: none;
            pointer-events: none;
            transition: background-image 0.5s ease, mask-image 0.5s ease, -webkit-mask-image 0.5s ease;
        }

        body.is-hovering .cyber-grid {
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            mask-image: radial-gradient(circle at var(--x, 50%) var(--y, 50%), black 0%, transparent 20%);
            -webkit-mask-image: radial-gradient(circle at var(--x, 50%) var(--y, 50%), black 0%, transparent 20%);
        }

        /* GLASS NAV */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark .glass {
            background: rgba(5, 5, 5, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* CONTACT FORM STYLES */
        .term-input {
            background: transparent;
            border: none;
            border-bottom: 1px solid #ccc;
            width: 100%;
            padding: 10px 0;
            outline: none;
            transition: 0.3s;
            font-family: 'Fira Code';
            color: #333;
        }

        .term-input:focus {
            border-color: var(--accent-secondary);
        }

        .dark .term-input {
            color: var(--text-primary);
            border-bottom-color: #333;
        }

        .dark .term-input:focus {
            border-color: var(--accent-primary);
        }

        /* OVERLAY TERMINAL STYLES */
        #terminal-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            cursor: pointer;
            padding: 0;
            background: none;
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #terminal-toggle:hover {
            transform: scale(1.05);
        }

        #overlay-terminal {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 500px;
            height: 350px;
            min-width: 300px;
            min-height: 200px;
            max-width: 90vw;
            max-height: 90vh;
            z-index: 99;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 15px var(--grid-color);
            display: flex;
            flex-direction: column;
            font-family: 'Fira Code', monospace;
            overflow: hidden;
            resize: both;
        }

        .term-bar {
            padding: 8px 12px;
            background: rgba(102, 252, 241, 0.1);
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
        }

        .term-output-area {
            flex-grow: 1;
            padding: 10px 12px;
            overflow-y: auto;
            color: #e5e5e5;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .term-output-area::-webkit-scrollbar {
            display: block;
            width: 6px;
        }

        .term-output-area::-webkit-scrollbar-thumb {
            background: rgba(102, 252, 241, 0.3);
            border-radius: 3px;
        }

        .term-output-area {
            scrollbar-width: thin;
            scrollbar-color: rgba(102, 252, 241, 0.3) transparent;
        }

        .term-input-line {
            display: flex;
            padding: 5px 12px 8px;
            border-top: 1px solid #333;
            align-items: center;
        }

        .term-prompt {
            color: #00ff00;
            white-space: nowrap;
            margin-right: 5px;
        }

        .term-input-cmd {
            background: transparent;
            border: none;
            color: var(--accent-primary);
            outline: none;
            width: 100%;
            font-size: 0.8rem;
        }
        /* --- SYSTEM CURSOR --- */
        body {
            cursor: crosshair;
        }
        a, button, .terminal-card, input, textarea, .project-terminal, .skill-card, .cert-card {
            cursor: pointer;
        }
    </style>
</head>

<body
    class="bg-gray-50 text-gray-900 dark:bg-bgDark dark:text-textMain transition-colors duration-300 min-h-screen flex flex-col">

    <div class="cyber-grid"></div>

    <nav class="fixed w-full z-50 top-0 start-0 glass transition-all duration-300">
        <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between p-4">
            <a href="index.html" class="flex items-center gap-2 group">
                <div
                    class="w-8 h-8 bg-neonBlue dark:bg-neonCyan rounded flex items-center justify-center text-white dark:text-black font-bold font-mono group-hover:rotate-12 transition-transform">
                    &lt;/&gt;</div>
                <span class="self-center text-xl font-bold tracking-wide dark:text-textMain">CodeBaaz</span>
            </a>
            <div class="flex items-center gap-6 font-mono text-sm">
                <a href="index.html" class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/Home</a>
                <a href="about.html" class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/About</a>
                <a href="projects.html"
                    class="hover:text-neonBlue dark:hover:text-neonCyan transition-colors">~/Work</a>
                <a href="contact.html" class="text-neonBlue dark:text-neonCyan">~/Contact</a>

                <button id="theme-toggle"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-white/10 transition-all">
                    <i class="ri-sun-line dark:hidden text-orange-500"></i>
                    <i class="ri-moon-line hidden dark:block text-neonCyan"></i>
                </button>
            </div>
        </div>
    </nav>

    <section id="contact-page"
        class="relative z-10 pt-32 pb-20 container mx-auto px-6 min-h-[80vh] flex flex-col justify-center flex-grow">
        <div class="max-w-6xl mx-auto w-full grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-center">

            <div class="space-y-8">
                <h1 class="text-4xl md:text-5xl font-bold font-mono break-all leading-tight">
                    <span class="text-neonBlue dark:text-neonCyan">./</span>Initialize_Comm
                </h1>
                <p class="text-gray-600 dark:text-gray-400 text-lg">
                    Have a project in mind or just want to discuss the latest tech? Execute the form command.
                </p>

                <div class="space-y-4 font-mono">
                    <div class="flex items-center gap-4 group cursor-pointer">
                        <div
                            class="w-10 h-10 bg-gray-200 dark:bg-gray-800 rounded flex items-center justify-center group-hover:text-neonBlue dark:group-hover:text-neonCyan transition-colors">
                            <i class="ri-mail-send-line text-xl"></i>
                        </div>
                        <span
                            class="group-hover:text-neonBlue dark:group-hover:text-neonCyan break-all">shashwatop89@gmail.com</span>
                    </div>
                    <div class="flex items-center gap-4 group cursor-pointer">
                        <div
                            class="w-10 h-10 bg-gray-200 dark:bg-gray-800 rounded flex items-center justify-center group-hover:text-neonBlue dark:group-hover:text-neonCyan transition-colors">
                            <i class="ri-github-line text-xl"></i>
                        </div>
                        <span
                            class="group-hover:text-neonBlue dark:group-hover:text-neonCyan break-all">github.com/ShashwatEv</span>
                    </div>
                </div>
            </div>

            <div
                class="bg-white dark:bg-bgDark p-8 rounded-lg border border-gray-200 dark:border-gray-800 shadow-xl relative overflow-hidden transition-colors duration-500">
                <div
                    class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-600 dark:from-neonCyan dark:to-purple-500">
                </div>
                <div class="flex gap-2 mb-6">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>

                 <form action="https://api.web3forms.com/submit" method="POST" class="space-y-6">
                    <input type="hidden" name="access_key" value="e48ea064-c4b0-46d0-86c5-dbda6644e805">

                    <div>
                        <label class="block font-mono text-xs text-gray-500 mb-1">var Name =</label>
                        <input type="text" name="name" placeholder="'Your Name'" class="term-input" required>
                    </div>
                    <div>
                        <label class="block font-mono text-xs text-gray-500 mb-1">var Email =</label>
                        <input type="email" name="email" placeholder="'your@email.com'" class="term-input" required>
                    </div>
                    <div>
                        <label class="block font-mono text-xs text-gray-500 mb-1">const Message =</label>
                        <textarea name="message" rows="4" placeholder="// Type your message here..." class="term-input"
                            required></textarea>
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-neonBlue dark:bg-neonCyan text-white dark:text-black font-bold font-mono rounded hover:shadow-lg transition-all transform hover:translate-y-[-2px]">
                        > Execute Send()
                    </button>
                </form>
            </div>

        </div>
    </section>

    <footer id="main-footer" class="bg-black border-t border-gray-800 relative z-10">
        <div class="w-full py-8 overflow-hidden relative border-b border-gray-800">
            <div class="absolute inset-0 bg-gradient-to-r from-black via-transparent to-black z-10 pointer-events-none">
            </div>
            <div class="flex w-full overflow-hidden">
                <div class="flex animate-infinite-scroll gap-16 items-center px-4">
                    <i
                        class="ri-reactjs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-400 transition-colors"></i>
                    <i
                        class="ri-html5-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-orange-500 transition-colors"></i>
                    <i
                        class="ri-css3-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-600 transition-colors"></i>
                    <i
                        class="ri-javascript-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-yellow-400 transition-colors"></i>
                    <i
                        class="ri-nodejs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-green-500 transition-colors"></i>
                    <i
                        class="ri-reactjs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-400 transition-colors"></i>
                    <i
                        class="ri-html5-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-orange-500 transition-colors"></i>
                    <i
                        class="ri-css3-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-blue-600 transition-colors"></i>
                    <i
                        class="ri-javascript-fill text-4xl text-gray-500 dark:text-gray-400 hover:text-yellow-400 transition-colors"></i>
                    <i
                        class="ri-nodejs-line text-4xl text-gray-500 dark:text-gray-400 hover:text-green-500 transition-colors"></i>
                </div>
            </div>
        </div>

        <div
            class="max-w-7xl mx-auto px-6 py-6 flex justify-between items-center text-xs font-mono text-gray-400 dark:text-gray-500">
            <div class="flex items-center gap-2"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                System Operational</div>
            <div id="clock">00:00:00 UTC</div>
        </div>
    </footer>
    <button id="terminal-toggle" aria-label="Open Terminal">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100">
            <rect width="100" height="100" rx="10" ry="10" fill="#000000" stroke="var(--accent-primary)"
                stroke-width="3" />
            <text x="50" y="50" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif"
                font-size="35" fill="var(--accent-primary)" font-weight="bold">
                &lt;/&gt;
            </text>
            <circle cx="80" cy="80" r="10" fill="#27c93f" stroke="#000000" stroke-width="2" />
        </svg>
    </button>

    <div id="overlay-terminal" style="display: none;">
        <div class="term-bar" id="term-header">
            <span class="text-neonCyan font-bold text-sm">System Terminal — contact.html</span>
            <span class="text-sm cursor-pointer"
                onclick="document.getElementById('overlay-terminal').style.display='none';"><i
                    class="ri-close-line text-white/50 hover:text-white"></i></span>
        </div>
        <div class="term-output-area" id="terminal-output">
            <div class="text-xs text-gray-400 pb-2 border-b border-gray-800 mb-2">
                Welcome to Shashwat's System Shell (SSH). Type 'help' for commands.
            </div>
        </div>
        <div class="term-input-line">
            <span class="term-prompt" id="current-prompt">Shash@port:~$</span>
            <input type="text" id="terminal-input" class="term-input-cmd" autocomplete="off" autofocus>
        </div>
    </div>
    <script>
        // --- Shared Terminal Logic (STARTS HERE) ---
        
            const terminalOutput = document.getElementById('terminal-output');
            const terminalInput = document.getElementById('terminal-input');
            const overlayTerminal = document.getElementById('overlay-terminal');
            const toggleButton = document.getElementById('terminal-toggle');
            const promptSpan = document.getElementById('current-prompt');

            const PROMPT = 'Shash@port:~$';

            // --- HISTORY LOGIC ---
            let commandHistory = [];
            let historyIndex = -1;

            // --- THEME DATABASE & LOGIC ---
            const themeData = {
                'default': {
                    '--bg-primary': '#050505',
                    '--text-primary': '#e5e5e5',
                    '--accent-primary': '#66fcf1',
                    '--accent-secondary': '#3b82f6',
                    '--grid-color': 'rgba(102, 252, 241, 0.15)'
                },
                'matrix': {
                    '--bg-primary': '#000000',
                    '--text-primary': '#00dd00',
                    '--accent-primary': '#00ff41',
                    '--accent-secondary': '#008f11',
                    '--grid-color': 'rgba(0, 255, 65, 0.2)'
                },
                'cyberpunk': {
                    '--bg-primary': '#0f0014',
                    '--text-primary': '#fcee0a',
                    '--accent-primary': '#ff003c',
                    '--accent-secondary': '#00f0ff',
                    '--grid-color': 'rgba(255, 0, 60, 0.2)'
                },
                'ocean': {
                    '--bg-primary': '#001e2b',
                    '--text-primary': '#e0f7fa',
                    '--accent-primary': '#00e5ff',
                    '--accent-secondary': '#18ffff',
                    '--grid-color': 'rgba(0, 229, 255, 0.15)'
                },
                'sunset': {
                    '--bg-primary': '#2d1b2e',
                    '--text-primary': '#ffcc00',
                    '--accent-primary': '#ff5e62',
                    '--accent-secondary': '#ff9966',
                    '--grid-color': 'rgba(255, 94, 98, 0.2)'
                },
                'dracula': {
                    '--bg-primary': '#282a36',
                    '--text-primary': '#f8f8f2',
                    '--accent-primary': '#ff79c6',
                    '--accent-secondary': '#bd93f9',
                    '--grid-color': 'rgba(189, 147, 249, 0.15)'
                },
                'coffee': {
                    '--bg-primary': '#2b211e',
                    '--text-primary': '#dcc9bc',
                    '--accent-primary': '#d4a373',
                    '--accent-secondary': '#a98467',
                    '--grid-color': 'rgba(212, 163, 115, 0.15)'
                },
                'light': {
                    '--bg-primary': '#ffffff',
                    '--text-primary': '#111827',
                    '--accent-primary': '#2563eb',
                    '--accent-secondary': '#4f46e5',
                    '--grid-color': 'rgba(37, 99, 235, 0.1)'
                }
            };

            function applyTheme(themeName) {
                const theme = themeData[themeName];
                if (!theme) return false;

                const root = document.documentElement;

                // 1. Update CSS Variables
                for (const [property, value] of Object.entries(theme)) {
                    root.style.setProperty(property, value);
                }

                // 2. Handle Tailwind Dark Mode Class
                if (themeName === 'light') {
                    root.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    root.classList.add('dark');
                    localStorage.theme = 'dark';
                }

                // 3. Persist specific theme name
                localStorage.customTheme = themeName;
                return true;
            }

            // Restore theme on load
            if (localStorage.customTheme && themeData[localStorage.customTheme]) {
                applyTheme(localStorage.customTheme);
            }

            // --- Terminal Utility Functions ---

            function echoInput(command) {
                const outputLine = document.createElement('div');
                outputLine.innerHTML = `<span class="term-prompt">${PROMPT}</span> ${command}`;
                terminalOutput.appendChild(outputLine);
            }

            function print(message, colorClass = 'text-white') {
                const outputLine = document.createElement('div');
                outputLine.innerHTML = `<span class="${colorClass}">${message}</span>`;
                terminalOutput.appendChild(outputLine);
            }

            function scrollToBottom() {
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }

            // --- Terminal Command Definitions ---

            const commands = {
                'whoami': {
                    desc: 'Displays author bio and primary role.',
                    exec: () => {
                        speak("Authenticating user... Identity verified: Shashwat Singh."); // <--- ADD THIS
                        print("Name: Shashwat Singh", 'text-neonCyan');
                        print("Role: Full Stack Developer / System Architect", 'text-neonCyan');
                        print("Motto: Building scalable systems, line by line.", 'text-gray-400');
                    }
                },
                'cam': {
                    desc: 'Activates the ASCII Reflection Protocol (Webcam).',
                    exec: () => {
                        print("[INIT] Accessing optical sensors...", "text-yellow-500");

                        const video = document.createElement('video');
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d', { willReadFrequently: true });

                        // ASCII Setup
                        const chars = "Ñ@#W$9876543210?!abc;:+=-,._                    ";
                        const termOutput = document.getElementById('terminal-output');
                        const asciiDiv = document.createElement('div');
                        asciiDiv.style.fontFamily = 'monospace';
                        asciiDiv.style.fontSize = '6px'; // Tiny font for high res
                        asciiDiv.style.lineHeight = '6px';
                        asciiDiv.style.whiteSpace = 'pre';
                        asciiDiv.style.overflow = 'hidden';
                        asciiDiv.className = 'text-neonBlue animate-pulse';
                        termOutput.appendChild(asciiDiv);

                        navigator.mediaDevices.getUserMedia({ video: { width: 100, height: 100 } })
                            .then(stream => {
                                video.srcObject = stream;
                                video.play();

                                const frame = () => {
                                    if (!video.srcObject) return; // Stop if stream cut

                                    canvas.width = 100;
                                    canvas.height = 60; // Aspect ratio adjustment
                                    ctx.drawImage(video, 0, 0, 100, 60);

                                    const imageData = ctx.getImageData(0, 0, 100, 60);
                                    const data = imageData.data;
                                    let asciiStr = "";

                                    for (let i = 0; i < data.length; i += 4) {
                                        const r = data[i];
                                        const g = data[i + 1];
                                        const b = data[i + 2];
                                        const avg = (r + g + b) / 3;
                                        const charIndex = Math.floor((avg / 255) * (chars.length - 1));

                                        asciiStr += chars[charIndex];
                                        if ((i / 4 + 1) % 100 === 0) asciiStr += "\n";
                                    }

                                    asciiDiv.innerText = asciiStr;
                                    requestAnimationFrame(frame);
                                };
                                frame();
                                print("[SUCCESS] Optical feed established.", "text-green-500");
                            })
                            .catch(e => print("[ERROR] Sensor access denied.", "text-red-500"));
                    }
                },
                'theme': {
                    desc: 'Change system UI colors. Usage: theme [name] | theme list',
                    exec: (args) => {
                        const subCmd = args[1];

                        if (subCmd === 'list') {
                            print("Available Themes:", 'text-neonCyan');
                            Object.keys(themeData).forEach(t => {
                                print(`  - ${t}`, 'text-gray-400');
                            });
                            return;
                        }

                        if (themeData[subCmd]) {
                            applyTheme(subCmd);
                            print(`System Theme set to: [${subCmd.toUpperCase()}]`, 'text-green-500');
                        } else {
                            print(`Error: Theme '${subCmd}' not found. Type 'theme list' for options.`, 'text-error');
                        }
                    }
                },
                'ls -l /': {
                    desc: 'Lists main system directories (navigation links).',
                    exec: () => {
                        print("drwxrwxr-x 4096 <span class='text-neonCyan'>home</span>", 'text-neonCyan');
                        print("drwxrwxr-x 4096 <span class='text-neonCyan'>about</span>", 'text-neonCyan');
                        print("drwxrwxr-x 4096 <span class='text-neonCyan'>work</span>", 'text-neonCyan');
                        print("drwxrwxr-x 4096 <span class='text-neonCyan'>contact</span>", 'text-neonCyan');
                    }
                },
                'neofetch': {
                    desc: 'Displays stylized system specifications (Host, Shell, Status).',
                    exec: () => {
                        print('<span style="color:#8B5CF6">/\\_/\\</span>', 'text-gray-400');
                        print('<span style="color:#8B5CF6">( o.o )</span> <span class="text-neonCyan font-semibold">Host</span>: Vercel Cloud', 'text-gray-400');
                        print('<span style="color:#8B5CF6"> > ^ < </span> <span class="text-neonCyan font-semibold">Loc</span>: 127.0.0.1', 'text-gray-400');
                        print('       <span class="text-neonCyan font-semibold">Shell</span>: ZSH v5.8', 'text-gray-400');
                        print('       <span class="text-green-500 font-bold">● Online</span>');
                    }
                },
                'date': {
                    desc: 'Displays the current local date and time.',
                    exec: () => {
                        print(new Date().toString(), 'text-neonCyan');
                    }
                },
                'clear': {
                    desc: 'Clears the terminal output screen.',
                    exec: () => {
                        terminalOutput.innerHTML = '';
                    }
                },
                'exit': {
                    desc: 'Closes the terminal overlay.',
                    exec: () => {
                        overlayTerminal.style.display = 'none';
                    }
                },
                'help': {
                    desc: 'Lists all available commands.',
                    exec: () => {
                        print("Available Commands:", 'text-neonCyan');
                        Object.keys(commands).forEach(cmd => {
                            print(`  ${cmd.padEnd(15, ' ')} -> ${commands[cmd].desc}`, 'text-gray-400');
                        });
                        print("Navigation: cd home | cd work | cd contact", 'text-info');
                    }
                },
                'ping': {
                    desc: 'Simulates a network latency check.',
                    exec: (args) => {
                        const host = args[1] || 'shashwat.dev';
                        print(`PING ${host} (${Math.random().toFixed(2)}): 64 bytes from ${host}: icmp_seq=1 time=${(Math.random() * 10).toFixed(2)} ms`, 'text-green-500');
                    }
                },
                'grep': {
                    desc: 'Searches the skills list for a keyword (e.g., grep react /skills).',
                    exec: (args) => {
                        const term = (args[1] || '').toLowerCase();
                        const skills = "React, Next.js, Tailwind, HTML5, CSS3, C/C++, Node.js, Python, Django, PostgreSQL, Mongo, Redis, Docker, AWS, Git";
                        const results = skills.split(', ').filter(s => s.toLowerCase().includes(term));

                        if (term && results.length > 0) {
                            print(`Found matching skills: ${results.join(', ')}`, 'text-neonCyan');
                        } else if (term) {
                            print(`No skills found matching '${term}'.`, 'text-error');
                        } else {
                            print("Usage: grep [keyword] /skills", 'text-gray-400');
                        }
                    }
                },
                'read -f /readme.txt': {
                    desc: 'Prints a philosophy/future plans statement.',
                    exec: () => {
                        print("##################################################", 'text-info');
                        print("// System Philosophy:", 'text-neonCyan');
                        print("// I believe software should be fast, reliable, and deeply intentional.", 'text-gray-400');
                        print("// Next Goal: Dive deep into WebAssembly and Rust for performance optimization.", 'text-gray-400');
                        print("##################################################", 'text-info');
                    }
                },
                'sudo reboot': {
                    desc: 'Initiates a simulated system reboot (redirects via confirmation).',
                    exec: () => {
                        print("[SUDO] WARNING: System will restart. Proceed? (y/n)", 'text-error');
                        terminalInput.setAttribute('data-confirm', 'reboot');
                    }
                },
                'reactor': {
                    desc: 'Links the Cyber-Grid to ambient audio (Music/Voice).',
                    exec: async () => {
                        try {
                            print("[INIT] Calibrating auditory sensors...", "text-yellow-500");
                            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                            const source = audioCtx.createMediaStreamSource(stream);
                            const analyser = audioCtx.createAnalyser();
                            analyser.fftSize = 256;
                            source.connect(analyser);

                            const bufferLength = analyser.frequencyBinCount;
                            const dataArray = new Uint8Array(bufferLength);
                            const grid = document.querySelector('.cyber-grid');

                            print("[SUCCESS] Reactor Online. Play some music.", "text-green-500");

                            function renderFrame() {
                                requestAnimationFrame(renderFrame);
                                analyser.getByteFrequencyData(dataArray);

                                // Calculate average volume (Bass/Low-Mids focus)
                                let sum = 0;
                                for (let i = 0; i < 50; i++) { sum += dataArray[i]; }
                                const average = sum / 50;

                                // Map volume to CSS properties
                                // Opacity pulses, Scale zooms in/out slightly
                                const opacity = 0.1 + (average / 255) * 0.5;
                                const scale = 1 + (average / 1000);

                                if (grid) {
                                    grid.style.opacity = opacity;
                                    grid.style.transform = `scale(${scale})`;
                                    // Optional: Change color based on intensity
                                    if (average > 100) grid.style.setProperty('--grid-color', 'rgba(255, 0, 60, 0.4)'); // Red on drop
                                    else grid.style.setProperty('--grid-color', 'rgba(102, 252, 241, 0.15)'); // Cyan default
                                }
                            }
                            renderFrame();
                        } catch (e) {
                            print("[ERROR] Audio access denied.", "text-red-500");
                        }
                    }
                },
                'man': {
                    desc: 'Displays the manual page for a command (e.g., man cd).',
                    exec: (args) => {
                        const command = args[1];
                        if (command === 'cd') {
                            print("NAME: cd - Change the active directory/section.", 'text-neonCyan');
                            print("SYNOPSIS: cd [home|about|work|contact]", 'text-gray-400');
                        } else if (commands[command]) {
                            print(`MANUAL: ${command} -> ${commands[command].desc}`, 'text-neonCyan');
                        } else {
                            print("Error: No manual entry for command.", 'text-error');
                        }
                    }
                },
                'rm -rf /': {
                    desc: 'WARNING: INITIATES SYSTEM PURGE.',
                    exec: () => {
                        print("WARNING: ROOT DELETION INITIATED...", "text-red-600 font-bold animate-pulse");
                        print("Are you sure? This cannot be undone.", "text-red-600");

                        setTimeout(() => {
                            const allElements = document.body.querySelectorAll('*');
                            const total = allElements.length;
                            let count = 0;

                            // Nuke sound
                            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                            const interval = setInterval(() => {
                                if (count >= total) {
                                    clearInterval(interval);
                                    document.body.innerHTML = '<div style="height:100vh;background:black;display:flex;align-items:center;justify-content:center;color:red;font-family:monospace;">SYSTEM_OFFLINE</div>';
                                    return;
                                }

                                // Randomly select an element to delete
                                const target = allElements[Math.floor(Math.random() * total)];
                                if (target && target.parentNode) {
                                    target.style.transition = "all 0.1s";
                                    target.style.transform = "scale(0) rotate(20deg)";
                                    target.style.opacity = "0";
                                    setTimeout(() => target.remove(), 100);

                                    // Zapping Sound
                                    if (count % 5 === 0) { // Don't play on every single one (too loud)
                                        const osc = audioCtx.createOscillator();
                                        const gain = audioCtx.createGain();
                                        osc.connect(gain);
                                        gain.connect(audioCtx.destination);
                                        osc.type = 'sawtooth';
                                        osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                                        osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.1);
                                        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                                        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
                                        osc.start();
                                        osc.stop(audioCtx.currentTime + 0.1);
                                    }
                                }
                                count++;
                            }, 10); // Very fast deletion
                        }, 2000);
                    }
                },
                'ssh': {
                    desc: 'Simulates a secure connection attempt.',
                    exec: () => {
                        print("Handshake initiated...", 'text-info');
                        setTimeout(() => {
                            print("SUCCESS: Connection to api.shash.dev Established.", 'text-green-500');
                            scrollToBottom();
                        }, 500);
                    }
                },
            };

            // --- Command Runner ---

            function runCommand(command) {
                if (!command) return;

                const parts = command.trim().toLowerCase().split(/\s+/);
                const baseCommand = parts[0];

                if (baseCommand === 'cd' && parts.length === 2) {
                    const dir = parts[1];
                    let url = '';
                    if (dir === 'home') url = 'index.html';
                    else if (dir === 'about') url = 'about.html';
                    else if (dir === 'work' || dir === 'projects') url = 'projects.html';
                    else if (dir === 'contact' || dir === 'comm') url = 'contact.html';

                    if (url) {
                        print(`Navigating to /${dir} ...`, 'text-info');
                        setTimeout(() => window.location.href = url, 300);
                        return;
                    }
                }

                // Handle complex commands (e.g., 'read -f /README.txt' or 'ls -l /')
                const complexCommand = command.trim().toLowerCase();
                if (commands[complexCommand]) {
                    commands[complexCommand].exec(parts);
                    return;
                }

                if (commands[baseCommand]) {
                    commands[baseCommand].exec(parts);
                    return;
                }

                print(`Error: command not found: ${command}`, 'text-error');
            }

            // --- Input and Confirmation Handler ---

            terminalInput.addEventListener('keydown', (e) => {
                // HISTORY NAVIGATION
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        terminalInput.value = commandHistory[historyIndex];
                    } else if (historyIndex === -1 && commandHistory.length > 0) {
                        historyIndex = commandHistory.length - 1;
                        terminalInput.value = commandHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1 && historyIndex !== -1) {
                        historyIndex++;
                        terminalInput.value = commandHistory[historyIndex];
                    } else {
                        historyIndex = commandHistory.length;
                        terminalInput.value = '';
                    }
                }
                // EXECUTION
                else if (e.key === 'Enter') {
                    e.preventDefault();
                    const command = terminalInput.value.trim();
                    const confirmState = terminalInput.getAttribute('data-confirm');

                    if (command) {
                        commandHistory.push(command);
                        historyIndex = commandHistory.length;
                    }

                    echoInput(command);

                    if (confirmState === 'reboot') {
                        if (command === 'y') {
                            print("System rebooting...", 'text-error');
                            setTimeout(() => window.location.href = 'loading.html', 500);
                        } else {
                            print("Reboot cancelled.", 'text-green-500');
                        }
                        terminalInput.removeAttribute('data-confirm');
                    } else {
                        runCommand(command);
                    }

                    terminalInput.value = '';
                    scrollToBottom();
                }
            });

            // --- Drag and Resize Logic ---
            const termHeader = document.getElementById('term-header');
            let isDragging = false;
            let offsetX, offsetY;

            termHeader.addEventListener('mousedown', (e) => {
                isDragging = true;
                const rect = overlayTerminal.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;

                overlayTerminal.style.cursor = 'move';
                overlayTerminal.style.position = 'fixed';
                overlayTerminal.style.right = 'auto';
                overlayTerminal.style.bottom = 'auto';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;

                if (newX < 0) newX = 0;
                if (newY < 0) newY = 0;
                if (newX + overlayTerminal.offsetWidth > window.innerWidth) newX = window.innerWidth - overlayTerminal.offsetWidth;
                if (newY + overlayTerminal.offsetHeight > window.innerHeight) newY = window.innerHeight - overlayTerminal.offsetHeight;

                overlayTerminal.style.left = newX + 'px';
                overlayTerminal.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                overlayTerminal.style.cursor = 'default';
            });

            // --- Toggle Button Logic ---
            toggleButton.addEventListener('click', () => {
                const isHidden = overlayTerminal.style.display === 'none';
                overlayTerminal.style.display = isHidden ? 'flex' : 'none';
                if (isHidden) {
                    terminalInput.focus();
                }
            });

            // --- Initial Setup and Event Handling ---

            // Existing theme toggle logic (Icon Click)
            const themeBtn = document.getElementById('theme-toggle');
            const html = document.documentElement;
            themeBtn.addEventListener('click', () => {
                if (localStorage.customTheme && localStorage.customTheme !== 'default' && localStorage.customTheme !== 'light') {
                    applyTheme('default');
                }
                html.classList.toggle('dark');
                const isDark = html.classList.contains('dark');
                localStorage.theme = isDark ? 'dark' : 'light';

                if (isDark) applyTheme('default');
                else applyTheme('light');

                themeBtn.querySelector('.ri-sun-line').classList.toggle('hidden', isDark);
                themeBtn.querySelector('.ri-moon-line').classList.toggle('hidden', !isDark);
            });

            // Function to update clock
            function updateClock() {
                const now = new Date();
                document.getElementById('clock').innerText = now.toUTCString().split(' ')[4] + ' UTC';
            }
            setInterval(updateClock, 1000);

            // Spotlight/Glow Logic
            const grid = document.querySelector('.cyber-grid');
            const contactPage = document.getElementById('contact-page');
            const mainFooter = document.getElementById('main-footer');
            const body = document.body;

            function activateGlow() { body.classList.add('is-hovering'); }
            function deactivateGlow() { body.classList.remove('is-hovering'); }

            const glowSections = [contactPage, mainFooter].filter(el => el != null);

            glowSections.forEach(section => {
                section.addEventListener('mouseenter', activateGlow);
            });

            document.addEventListener('mouseout', function (e) {
                if (!e.relatedTarget && !e.toElement) {
                    deactivateGlow();
                }
            });

            window.addEventListener('mousemove', (e) => {
                if (grid) {
                    grid.style.setProperty('--x', `${e.clientX}px`);
                    grid.style.setProperty('--y', `${e.clientY}px`);
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                updateClock();
                
                // Theme Icon
                const isDark = html.classList.contains('dark');
                themeBtn.querySelector('.ri-sun-line').classList.toggle('hidden', isDark);
                themeBtn.querySelector('.ri-moon-line').classList.toggle('hidden', !isDark);

                // --- PARTICLES ---
               const cursorCanvas = document.createElement('canvas');
                const cursorCtx = cursorCanvas.getContext('2d');
                cursorCanvas.style.position = 'fixed';
                cursorCanvas.style.top = '0';
                cursorCanvas.style.left = '0';
                cursorCanvas.style.width = '100%';
                cursorCanvas.style.height = '100%';
                cursorCanvas.style.pointerEvents = 'none';
                cursorCanvas.style.zIndex = '9998';
                document.body.appendChild(cursorCanvas);

                let cursorParticles = [];

                function resizeCursorCanvas() {
                    cursorCanvas.width = window.innerWidth;
                    cursorCanvas.height = window.innerHeight;
                }
                window.addEventListener('resize', resizeCursorCanvas);
                resizeCursorCanvas();

                class Particle {
                    constructor(x, y) {
                        this.x = x;
                        this.y = y;
                        this.size = Math.random() * 3 + 1;
                        this.speedX = Math.random() * 2 - 1;
                        this.speedY = Math.random() * 2 - 1;
                        this.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
                        this.life = 1.0;
                    }
                    update() {
                        this.x += this.speedX;
                        this.y += this.speedY;
                        this.life -= 0.02;
                        if (this.size > 0.1) this.size -= 0.1;
                    }
                    draw() {
                        cursorCtx.fillStyle = this.color;
                        cursorCtx.globalAlpha = this.life;
                        cursorCtx.fillRect(this.x, this.y, this.size, this.size);
                        cursorCtx.globalAlpha = 1.0;
                    }
                }

                window.addEventListener('mousemove', (e) => {
                    cursorParticles.push(new Particle(e.clientX, e.clientY));
                    cursorParticles.push(new Particle(e.clientX, e.clientY));
                });

                function animateParticles() {
                    cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
                    for (let i = 0; i < cursorParticles.length; i++) {
                        cursorParticles[i].update();
                        cursorParticles[i].draw();
                        if (cursorParticles[i].life <= 0) {
                            cursorParticles.splice(i, 1);
                            i--;
                        }
                    }
                    requestAnimationFrame(animateParticles);
                }
                animateParticles();

                // --- INPUT HAPTICS ---
                document.querySelectorAll('input, textarea, button').forEach(el => {
                    el.addEventListener('focus', () => { if(navigator.vibrate) navigator.vibrate(10); });
                    el.addEventListener('click', () => { if(navigator.vibrate) navigator.vibrate(15); });
                });
            });
        
        // --- Shared Terminal Logic (ENDS HERE) ---
        // --- HACKER TEXT DECODE EFFECT ---
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%^&*";

        function hackerEffect(event) {
            const target = event.target;
            // Store original text if not already stored
            if (!target.dataset.value) target.dataset.value = target.innerText;

            let iteration = 0;
            const originalText = target.dataset.value;

            clearInterval(target.interval);

            target.interval = setInterval(() => {
                target.innerText = originalText
                    .split("")
                    .map((letter, index) => {
                        if (index < iteration) {
                            return originalText[index];
                        }
                        return letters[Math.floor(Math.random() * 62)];
                    })
                    .join("");

                if (iteration >= originalText.length) {
                    clearInterval(target.interval);
                }

                iteration += 1 / 3; // Controls speed (higher = faster)
            }, 30);
        }

        // Apply to all Section Headings (h2)
        document.querySelectorAll('h2').forEach(header => {
            header.addEventListener('mouseover', hackerEffect);
        });
        // --- AUDIO SYSTEM (Synthesized Sounds) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'hover') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'click') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.15);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.15);
            }
        }

        // Apply to all interactive elements
        document.querySelectorAll('a, button, .terminal-card').forEach(el => {
            el.addEventListener('mouseenter', () => playSound('hover'));
            el.addEventListener('click', () => playSound('click'));
        });
        // --- 3D TILT EFFECT ---
        document.querySelectorAll('.terminal-card').forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Calculate rotation (max 15 degrees)
                const xRot = -1 * ((y - rect.height / 2) / rect.height * 15);
                const yRot = (x - rect.width / 2) / rect.width * 15;

                card.style.transform = `perspective(1000px) rotateX(${xRot}deg) rotateY(${yRot}deg) scale(1.02)`;
                card.style.zIndex = '10';
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
                card.style.zIndex = '1';
            });
        });
        // --- KONAMI CODE EASTER EGG ---
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        document.addEventListener('keydown', (e) => {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    activateOverrideMode();
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        });

        function activateOverrideMode() {
            // 1. Play Alert Sound
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);

            osc.start();
            osc.stop(audioCtx.currentTime + 1);

            // 2. Change Theme to Red Alert
            document.documentElement.style.setProperty('--accent-primary', '#ff0000');
            document.documentElement.style.setProperty('--accent-secondary', '#ff4d00');
            document.documentElement.style.setProperty('--text-primary', '#ffcccc');

            // 3. Inject Warning Modal
            const warning = document.createElement('div');
            warning.className = 'fixed inset-0 flex items-center justify-center bg-black/90 z-[10000] text-red-500 font-mono text-4xl font-bold animate-pulse';
            warning.innerText = "SYSTEM OVERRIDE: ROOT ACCESS GRANTED";
            document.body.appendChild(warning);

            setTimeout(() => {
                warning.remove();
                alert("Welcome, Admin. Hidden features unlocked.");
            }, 2000);
        }
        // --- POWER MODE INPUT SHAKE ---
        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', function () {
                // Random shake offsets
                const x = Math.random() * 4 - 2;
                const y = Math.random() * 4 - 2;

                this.style.transform = `translate(${x}px, ${y}px)`;
                this.style.borderColor = 'var(--accent-primary)';

                // Reset after 100ms
                setTimeout(() => {
                    this.style.transform = 'translate(0, 0)';
                    this.style.borderColor = '';
                }, 100);
            });
        });
        // --- MECHANICAL KEYBOARD SFX ---
        function playKeyClick() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            // Create a short, sharp "click" using a high frequency burst
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.type = 'triangle';
            // Randomize slightly for realism
            osc.frequency.setValueAtTime(600 + Math.random() * 200, audioCtx.currentTime);

            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        document.addEventListener('keydown', playKeyClick);
        // --- SYSTEM SLEEP MODE ---
        let idleTimer;
        const sleepOverlay = document.getElementById('sleep-mode');

        function resetIdleTimer() {
            clearTimeout(idleTimer);
            if (sleepOverlay) {
                sleepOverlay.style.opacity = '0';
                sleepOverlay.classList.add('hidden');
                sleepOverlay.style.pointerEvents = 'none'; // Allow clicks to pass through
            }

            // Set idle time (e.g., 10 seconds)
            idleTimer = setTimeout(() => {
                if (sleepOverlay) {
                    sleepOverlay.classList.remove('hidden');
                    // Small delay to allow display:block to apply before opacity transition
                    setTimeout(() => {
                        sleepOverlay.style.opacity = '0.9';
                        sleepOverlay.style.pointerEvents = 'all'; // Block clicks
                    }, 50);
                }
            }, 10000);
        }

        // Reset on any interaction
        window.addEventListener('mousemove', resetIdleTimer);
        window.addEventListener('keydown', resetIdleTimer);
        window.addEventListener('scroll', resetIdleTimer);
        resetIdleTimer(); // Start immediately
        // --- PARALLAX GRID EFFECT ---
        const parallaxGrid = document.querySelector('.cyber-grid');

        document.addEventListener('mousemove', (e) => {
            if (!parallaxGrid) return;

            // Calculate movement (divided by 50 to make it subtle)
            const x = (window.innerWidth - e.pageX * 2) / 50;
            const y = (window.innerHeight - e.pageY * 2) / 50;

            parallaxGrid.style.transform = `translate(${x}px, ${y}px)`;
        });
        // --- VOICE COMMAND PROTOCOL (V.C.P) ---
        // Checks browser support (Chrome/Edge mostly)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            // Create a visual mic indicator
            const micIcon = document.createElement('div');
            micIcon.className = 'fixed bottom-5 left-5 z-[1000] text-gray-600 cursor-pointer transition-colors duration-300';
            micIcon.innerHTML = '<i class="ri-mic-off-line text-2xl"></i>';
            document.body.appendChild(micIcon);

            micIcon.addEventListener('click', () => {
                try { recognition.start(); } catch (e) { recognition.stop(); }
            });

            recognition.onstart = () => {
                micIcon.innerHTML = '<i class="ri-mic-line text-2xl animate-pulse text-red-500"></i>';
                print("[V.C.P] Listening...", 'text-yellow-500'); // Print to your terminal
            };

            recognition.onend = () => {
                micIcon.innerHTML = '<i class="ri-mic-off-line text-2xl"></i>';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                print(`> Voice Input: "${transcript}"`, 'text-neonCyan');

                // Command Logic
                if (transcript.includes('home')) { window.location.href = 'index.html'; }
                else if (transcript.includes('project') || transcript.includes('work')) { window.location.href = 'projects.html'; }
                else if (transcript.includes('contact')) { window.location.href = 'contact.html'; }
                else if (transcript.includes('theme matrix')) { applyTheme('matrix'); }
                else if (transcript.includes('theme cyberpunk')) { applyTheme('cyberpunk'); }
                else if (transcript.includes('system status')) {
                    document.getElementById('terminal-toggle').click();
                    runCommand('neofetch');
                }
            };
        } else {
            console.log("Voice API not supported in this browser.");
        }
        // --- MAGNETIC GRAVITY UI ---
        const magneticElements = document.querySelectorAll('button, a.px-6'); // Targets main buttons

        magneticElements.forEach(el => {
            el.addEventListener('mousemove', (e) => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                // "Pull" factor (higher = stronger pull)
                el.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
                el.style.transition = 'transform 0.1s ease-out';
            });

            el.addEventListener('mouseleave', () => {
                el.style.transform = 'translate(0px, 0px)';
                el.style.transition = 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)'; // Bouncy reset
            });
        });
        // --- DYNAMIC FAVICON GENERATOR ---
        const faviconCanvas = document.createElement('canvas');
        faviconCanvas.width = 32;
        faviconCanvas.height = 32;
        const faviconCtx = faviconCanvas.getContext('2d');
        const link = document.querySelector("link[rel~='icon']") || document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);

        function updateFavicon() {
            // Clear
            faviconCtx.clearRect(0, 0, 32, 32);

            // Get current theme accent color
            const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim() || '#00ff00';

            // Draw a "System Dot"
            faviconCtx.fillStyle = '#000000';
            faviconCtx.fillRect(0, 0, 32, 32); // Background

            faviconCtx.fillStyle = accent;
            faviconCtx.beginPath();
            faviconCtx.arc(16, 16, 10, 0, Math.PI * 2);
            faviconCtx.fill();

            // Add a blinking inner light
            if (new Date().getSeconds() % 2 === 0) {
                faviconCtx.fillStyle = '#ffffff';
                faviconCtx.beginPath();
                faviconCtx.arc(16, 16, 4, 0, Math.PI * 2);
                faviconCtx.fill();
            }

            link.href = faviconCanvas.toDataURL();
        }

        // Update every second
        setInterval(updateFavicon, 1000);
        // --- SINGULARITY: BIO-METRIC ENERGY LINK ---
        if ('getBattery' in navigator) {
            navigator.getBattery().then(battery => {
                function updateEnergyState() {
                    const level = battery.level * 100;
                    const isCharging = battery.charging;

                    if (level <= 20 && !isCharging) {
                        // EMERGENCY MODE
                        document.documentElement.style.filter = 'grayscale(0.8) brightness(0.6)';
                        document.body.classList.add('low-power');
                        if (!window.hasWarnedLowPower) {
                            print(`[WARNING] MAIN POWER CRITICAL (${Math.round(level)}%). ENGAGING POWER SAVING.`, 'text-red-500 animate-pulse');
                            window.hasWarnedLowPower = true;
                        }
                    } else {
                        // NORMAL MODE
                        document.documentElement.style.filter = 'none';
                        document.body.classList.remove('low-power');
                        if (window.hasWarnedLowPower && isCharging) {
                            print(`[SYSTEM] EXTERNAL POWER DETECTED. SYSTEMS NORMALIZING.`, 'text-green-500');
                            playSound('hover'); // Reuse your synth sound
                            window.hasWarnedLowPower = false;
                        }
                    }
                }

                battery.addEventListener('levelchange', updateEnergyState);
                battery.addEventListener('chargingchange', updateEnergyState);
                updateEnergyState(); // Initial check
            });
        }
        // --- SINGULARITY: STEALTH MODE (PANIC SWITCH) ---
        let escCount = 0;
        let escTimer;

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                escCount++;
                clearTimeout(escTimer);
                escTimer = setTimeout(() => escCount = 0, 500); // Reset if too slow

                if (escCount === 3) {
                    activateStealthMode();
                    escCount = 0;
                }
            }
        });

        function activateStealthMode() {
            document.title = "Quarterly_Report_2025.xlsx - Excel";
            // Nuke the body content
            document.body.innerHTML = `
        <div style="font-family: Arial, sans-serif; padding: 20px; background: #fff; color: #000; height: 100vh;">
            <div style="background: #217346; color: white; padding: 10px; font-weight: bold;">Microsoft Excel</div>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px;">
                <tr style="background: #f3f3f3;">
                    <th style="border: 1px solid #ccc; padding: 5px;">A</th>
                    <th style="border: 1px solid #ccc; padding: 5px;">B</th>
                    <th style="border: 1px solid #ccc; padding: 5px;">C</th>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">1</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Revenue</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">$1,204,500</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">2</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Growth</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">12.5%</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ccc; padding: 5px;">3</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Q4 Target</td>
                    <td style="border: 1px solid #ccc; padding: 5px;">Pending</td>
                </tr>
            </table>
            <div style="margin-top: 50px; color: #666;">Press F5 to Reload System</div>
        </div>
    `;
            // Kill all sounds
            if (window.audioCtx) window.audioCtx.close();
        }
        // --- GAMEPAD CONTROL PROTOCOL ---
        let gamepadLoop;

        window.addEventListener("gamepadconnected", (e) => {
            const gpIndex = e.gamepad.index;
            const alertBox = document.createElement('div');
            alertBox.className = 'fixed top-5 left-1/2 transform -translate-x-1/2 bg-neonBlue text-black px-4 py-2 font-mono text-sm z-[10000] rounded shadow-[0_0_15px_var(--accent-primary)]';
            alertBox.innerText = "🎮 CONTROLLER DETECTED: ENGAGING DRIVE MODE";
            document.body.appendChild(alertBox);
            setTimeout(() => alertBox.remove(), 3000);

            // Start polling
            gamepadLoop = setInterval(() => {
                const gp = navigator.getGamepads()[gpIndex];
                if (!gp) return;

                // Right Stick Y-Axis (Scroll)
                if (Math.abs(gp.axes[3]) > 0.2) {
                    window.scrollBy(0, gp.axes[3] * 20); // Speed factor
                }

                // Button A (Bottom Button) - Trigger Click on center element
                if (gp.buttons[0].pressed) {
                    // Find element in center of screen
                    const x = window.innerWidth / 2;
                    const y = window.innerHeight / 2;
                    const el = document.elementFromPoint(x, y);
                    if (el) el.click();
                }

                // Button B (Right Button) - Go Back/Top
                if (gp.buttons[1].pressed) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 16); // 60 FPS
        });

        window.addEventListener("gamepaddisconnected", () => {
            clearInterval(gamepadLoop);
        });
        // --- AMBIENT LIGHT REACTOR ---
        if ('AmbientLightSensor' in window) {
            try {
                const sensor = new AmbientLightSensor();
                sensor.addEventListener('reading', () => {
                    const lux = sensor.illuminance;
                    const root = document.documentElement;

                    if (lux < 10) {
                        // Pitch black room -> Max Glow
                        root.style.setProperty('--grid-opacity', '0.5');
                        root.style.setProperty('--text-shadow', '0 0 10px var(--accent-primary)');
                    } else if (lux > 500) {
                        // Bright Sun -> High Contrast / Dim Glow
                        root.style.setProperty('--grid-opacity', '0.1');
                        root.style.setProperty('--text-shadow', 'none');
                    }
                });
                sensor.start();
            } catch (err) {
                console.log("Light sensor blocked by permissions policy.");
            }
        }
        console.log(
            "%c STOP! %c \nAuthorized personnel only. \nAll actions are being logged.",
            "color: red; font-size: 50px; font-weight: bold; text-shadow: 2px 2px black;",
            "color: #66fcf1; font-family: monospace; font-size: 14px;"
        );
        console.log(
            "%c      _    _      \n     | |  | |     \n  ___| |__| |__   \n / __|  __  |\\ \\  \n \\__ \\ |  | |/ /  \n |___/_|  |_/_/   \n",
            "color: #3b82f6; font-weight: bold;"
        );
        // --- PERSISTENT MEMORY CORE ---
        function saveSystemState() {
            const state = {
                theme: localStorage.customTheme || 'default',
                commandsRun: commandHistory.length,
                adminUnlocked: window.isAdmin || false,
                lastLogin: Date.now()
            };
            localStorage.setItem('system_core_memory', JSON.stringify(state));
        }

        function loadSystemState() {
            const memory = JSON.parse(localStorage.getItem('system_core_memory'));
            if (memory) {
                // Restore Theme
                if (memory.theme) applyTheme(memory.theme);

                // Welcome message based on time
                const days = Math.floor((Date.now() - memory.lastLogin) / (1000 * 60 * 60 * 24));
                if (days > 0) {
                    print(`Welcome back, User. It has been ${days} days since last login.`, "text-neonBlue");
                } else {
                    print("Session restored. Welcome back.", "text-neonBlue");
                }
            }
        }

        // Hook into your 'exit' or 'beforeunload' event
        window.addEventListener('beforeunload', saveSystemState);
        // Hook into load
        window.addEventListener('DOMContentLoaded', loadSystemState);
        // --- DOM INTEGRITY WATCHDOG ---
        const essentialIDs = ['hero-section', 'terminal-toggle', 'main-footer'];

        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.removedNodes.length > 0) {
                    mutation.removedNodes.forEach(node => {
                        if (node.id && essentialIDs.includes(node.id)) {
                            // ALERT!
                            const audio = new AudioContext(); // fast beep
                            // (Insert your beep code here)

                            alert("⚠️ CRITICAL ERROR: CORE COMPONENT DELETED.\nINITIATING EMERGENCY REFRESH.");
                            location.reload(); // Force reload to "repair"
                        }
                    });
                }
            });
        });

        observer.observe(document.body, { childList: true, subtree: true });
        // --- BULLET TIME PROTOCOL ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Shift') {
                document.body.style.transition = 'all 0.5s ease';
                // Force hardware acceleration on everything
                document.documentElement.style.setProperty('--time-scale', '0.1');

                // This is the magic CSS injection
                const css = `* { animation-duration: 10s !important; transition-duration: 2s !important; }`;
                const style = document.createElement('style');
                style.id = 'bullet-time-css';
                style.innerText = css;
                document.head.appendChild(style);

                // Play "Power Down" sound
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
                osc.start(); osc.stop(audioCtx.currentTime + 1);
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'Shift') {
                const style = document.getElementById('bullet-time-css');
                if (style) style.remove();
                document.documentElement.style.removeProperty('--time-scale');
            }
        });
        // --- NEURAL VOICE MODULE ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                utterance.voice = voices.find(v => v.name.includes('Google US English')) || voices[0];
                utterance.pitch = 0.8;
                utterance.rate = 1.1;
                utterance.volume = 0.5;
                window.speechSynthesis.speak(utterance);
            }
        }
    </script>
</body>

</html>